var YHDPlaceSelector={init:function(){var a='<select id="province" name="province"><option value="0">请选择省</option></select>';a+='<select id="city"  name="city"><option value="0">请选择市/区</option></select>';a+='<select id="county" name="county"><option value="0">请选择区/县</option></select>';a+='<select id="area" name="area"><option value="0">请选择四级区域</option></select>';a+='&nbsp;&nbsp;<a href="javascript:void(0);" onclick="popQueryWindow();">邮编查询所在地区</a>';a+='<label id="areaMessage" class="range red"></label>';jQuery("#placeSelector").html(a);jQuery("#city,#county,#area").hide();jQuery("#province").change(function(){var b=jQuery(this);var c=b.val();jQuery("#county,#area,#cityTip,#countyTip,#areaTip").empty().hide();jQuery("#postCode").val("");if(c==0){jQuery("#provinceTip,#city").empty().hide()}else{YHDPlaceSelector.refresh("#city",2,c);
jQuery("#provinceTip").html(b.find(":selected").text()+"&nbsp;&nbsp;").show()}});jQuery("#city").change(function(){var b=jQuery(this);var c=b.val();jQuery("#area,#countyTip,#areaTip").empty().hide();jQuery("#postCode").val("");if(c==0){jQuery("#cityTip,#county").empty().hide()}else{YHDPlaceSelector.refresh("#county",3,c);jQuery("#cityTip").html(b.find(":selected").text()+"&nbsp;&nbsp;").show()}});jQuery("#county").change(function(){var c=jQuery(this);var d=c.val();jQuery("#areaTip").empty().hide();var b=c.find(":selected").attr("postcode");if(b==null||b=="null"||b==undefined){b=""}jQuery("#postCode").val(b);if(d==0){jQuery("#countyTip,#area").empty().hide()}else{YHDPlaceSelector.refresh("#area",4,d);jQuery("#countyTip").html(c.find(":selected").text()+"&nbsp;&nbsp;").show()}});jQuery("#area").change(function(){var c=jQuery(this);
var e=c.val();var d=jQuery("#county").find(":selected").attr("postcode");var b=c.find(":selected").attr("postcode");if(d==null||d=="null"||d==undefined){d=""}if(b==null||b=="null"||b==undefined){b=""}if(e==0){jQuery("#postCode").val(d);jQuery("#areaTip").empty().hide()}else{jQuery("#postCode").val(b);jQuery("#areaTip").html(c.find(":selected").text()+"&nbsp;&nbsp;").show()}})},refresh:function(b,d,a,e){if((e==0)&&d==4){jQuery(b).empty().hide();return}else{var c="/checkout/address/ajaxGetPlaceList.do";var f={id:a,type:d};jQuery.post(c,f,function(g){if(g.message=="success"&&g.data!=null&&g.data.length>0){YHDPlaceSelector.showUI(b,d,a,e,g.data)}},"json")}},showUI:function(d,f,c,g,h){var a="请选择";if(f==1){a="请选择省"}else{if(f==2){a="请选择市/区"}else{if(f==3){a="请选择区/县"}else{if(f==4){a="请选择四级区域"}}}}if((g==0)&&f==4&&map_load!=2){jQuery(d).empty().hide();
jQuery(d+"Tip").hide();return}else{if(h!=null&&h.length>0){jQuery(d).empty();var e='<option value="0">'+a+"</option>";var b=0;jQuery(h).each(function(j){if(j==0){b=this.id}if(c==this.id&&f==4){}else{if(this.id==g){e+='<option value="'+this.id+'" postcode="'+this.postcode+'" selected>'+this.name+"</option>"}else{if(f==4&&h.length==1&&jQuery("#county").find(":selected").text()==this.name){e='<option value="'+this.id+'" postcode="'+this.postcode+'" selected>'+this.name+"</option>"}else{e+='<option value="'+this.id+'" postcode="'+this.postcode+'">'+this.name+"</option>"}}}});jQuery(d).html(e);if(g!=null){if((c==g)&&f==4){}else{jQuery(d).attr("value",g)}if(g!=0){if((c==g)&&f==4){jQuery(d+"Tip").hide()}else{jQuery(d+"Tip").html(jQuery(d).find(":selected").text()+"&nbsp;&nbsp;").show()}}}if(c==b&&h.length==1&&f==4){jQuery(d).empty().hide();
jQuery(d+"Tip").hide()}else{if(h.length==1&&f==4&&jQuery("#county").find(":selected").text()==h[0].name){jQuery(d).hide()}else{jQuery(d).show()}}}else{jQuery(d).empty().hide()}}},updateDefaultCheckedStatus:function(e,f,a,d){var b="/checkout/address/ajaxGetFourPlaceLists.do";var c={provinceId:e,cityId:f,countyId:a};jQuery.post(b,c,function(g){if(g&&g.message=="success"){var i=g.data.provinceList;var j=g.data.cityList;var k=g.data.countyList;var h=g.data.areaList;if(e!=null&&e!=0){YHDPlaceSelector.showUI("#province",1,1,e,i);YHDPlaceSelector.showUI("#city",2,e,f,j);YHDPlaceSelector.showUI("#county",3,f,a,k);YHDPlaceSelector.showUI("#area",4,a,d,h)}else{YHDPlaceSelector.showUI("#province",1,1,0,i)}}else{alert("网络出现异常,请稍后重试!")}},"json")},initDefaultCheckedStatus:function(){YHDPlaceSelector.init();
var c=jQuery("#placeSelector").attr("provinceId");var d=jQuery("#placeSelector").attr("cityId");var a=jQuery("#placeSelector").attr("countyId");var b=jQuery("#placeSelector").attr("areaId");YHDPlaceSelector.updateDefaultCheckedStatus(c,d,a,b)},clearDefaultCheckedStatus:function(){jQuery("#province").attr("value",0);jQuery("#city,#county,#area").empty().hide();jQuery("#provinceTip,#cityTip,#countyTip,#areaTip").empty().hide()}};var manyFourPlace=0;var cityChange=0;var YHDMapPlaceSelector={init:function(){var a='<select id="province" name="province"><option value="0">请选择省</option></select>';a+='<select id="city"  name="city"><option value="0">请选择市/区</option></select>';a+='<select id="county" name="county"><option value="0">请选择区/县</option></select>';a+='<select id="area" name="area"></select>';
jQuery("#placeSelector").html(a);jQuery("#city,#county,#area").hide();if(isBigCity()){jQuery("#countyTip","#areaTip").empty().hide()}else{jQuery("#areaTip").empty().hide()}jQuery("#province").change(function(){var b=jQuery(this);var c=b.val();jQuery("#county,#area,#cityTip,#countyTip,#areaTip").empty().hide();jQuery("#postCode").val("");if(c==0){jQuery("#provinceTip,#city").empty().hide()}else{YHDMapPlaceSelector.refresh("#city",2,c);jQuery("#provinceTip").html(b.find(":selected").text()+"&nbsp;&nbsp;").show()}});jQuery("#city").change(function(){var b=jQuery(this);var c=b.val();jQuery("#area,#countyTip,#areaTip").empty().hide();jQuery("#postCode").val("");cityChange=1;if(c==0){jQuery("#cityTip,#county").empty().hide()}else{YHDMapPlaceSelector.refresh("#county",3,c);jQuery("#cityTip").html(b.find(":selected").text()+"&nbsp;&nbsp;").show();
getCurrAddress();if(jQuery("#detailAddress").val()!=""||jQuery("#detailAddress").val()!=null){areaAddress()}}});jQuery("#county").change(function(){var c=jQuery(this);var d=c.val();jQuery("#areaTip").empty().hide();var b=c.find(":selected").attr("postcode");if(b==null||b=="null"||b==undefined){b=""}jQuery("#postCode").val(b);if(d==0){jQuery("#countyTip,#area").empty().hide()}else{YHDMapPlaceSelector.refresh("#area",4,d);jQuery("#countyTip").html(c.find(":selected").text()+"&nbsp;&nbsp;").show()}})},refresh:function(b,d,a,e){if((e==0)&&d==4){jQuery(b).empty().hide();return}else{var c="/checkout/address/ajaxGetPlaceList.do";var f={id:a,type:d};jQuery.post(c,f,function(g){if(g.message=="success"&&g.data!=null&&g.data.length>0){YHDMapPlaceSelector.showUI(b,d,a,e,g.data);if(d==4&&g.data.length>1){manyFourPlace=1
}else{manyFourPlace=0}}},"json")}},showUI:function(d,f,c,g,h){var a="请选择";if(f==1){a="请选择省"}else{if(f==2){a="请选择市/区"}else{if(f==3){a="请选择区/县"}else{if(f==4){a="请选择四级区域"}}}}if((g==0)&&f==4){jQuery(d).empty().hide();jQuery(d+"Tip").hide();return}else{if(h!=null&&h.length>0){if((isBigCity()&&f<3)||(!isBigCity()&&f<4)){jQuery(d).empty();var e='<option value="0">'+a+"</option>";var b=0;jQuery(h).each(function(j){if(j==0){b=this.id}if(c==this.id&&f==4){}else{if(this.id==g){e+='<option value="'+this.id+'" postcode="'+this.postcode+'" selected>'+this.name+"</option>"}else{e+='<option value="'+this.id+'" postcode="'+this.postcode+'">'+this.name+"</option>"}}});jQuery(d).html(e);if(g!=null){if((c==g)&&f==4){}else{jQuery(d).attr("value",g)}if(g!=0){if((c==g)&&f==4){jQuery(d+"Tip").hide()}else{jQuery(d+"Tip").html(jQuery(d).find(":selected").text()+"&nbsp;&nbsp;").show()
}}}if(c==b&&h.length==1&&f==4){jQuery(d).empty().hide();jQuery(d+"Tip").hide()}else{jQuery(d).show()}}else{if(d=="#county"){var e="";jQuery(h).each(function(j){if(this.id==g){e='<option value="'+this.id+'" postcode="'+this.postcode+'" selected>'+this.name+"</option>"}});jQuery(d).html(e)}else{if(d=="#area"){var e="";var b=0;jQuery(h).each(function(j){if(j==0){b=this.id}if(this.id==g){e='<option value="'+this.id+'" postcode="'+this.postcode+'" selected>'+this.name+"</option>"}else{if(f==4&&h.length==1&&jQuery("#county").find(":selected").text()==this.name){e='<option value="'+this.id+'" postcode="'+this.postcode+'" selected>'+this.name+"</option>"}else{e+='<option value="'+this.id+'" postcode="'+this.postcode+'">'+this.name+"</option>"}}});jQuery(d).html(e);if(c==b&&h.length==1&&f==4){jQuery(d).empty().hide();
jQuery(d+"Tip").hide()}else{jQuery(d).show()}}}}}else{jQuery(d).empty().hide()}}},updateDefaultCheckedStatus:function(e,f,a,d){var b="/checkout/address/ajaxGetFourPlaceLists.do";var c={provinceId:e,cityId:f,countyId:a};jQuery.post(b,c,function(g){if(g&&g.message=="success"){var i=g.data.provinceList;var j=g.data.cityList;var k=g.data.countyList;var h=g.data.areaList;if(e!=null&&e!=0){YHDMapPlaceSelector.showUI("#province",1,1,e,i);YHDMapPlaceSelector.showUI("#city",2,e,f,j);YHDMapPlaceSelector.showUI("#county",3,f,a,k);YHDMapPlaceSelector.showUI("#area",4,a,d,h)}else{YHDMapPlaceSelector.showUI("#province",1,1,0,i)}}else{alert("网络出现异常,请稍后重试!")}},"json")},initDefaultCheckedStatus:function(){YHDMapPlaceSelector.init();var c=jQuery("#placeSelector").attr("provinceId");var d=jQuery("#placeSelector").attr("cityId");
var a=jQuery("#placeSelector").attr("countyId");var b=jQuery("#placeSelector").attr("areaId");YHDMapPlaceSelector.updateDefaultCheckedStatus(c,d,a,b)},clearDefaultCheckedStatus:function(){jQuery("#province").attr("value",0);jQuery("#city,#county,#area").empty().hide();jQuery("#provinceTip,#cityTip,#countyTip,#areaTip").empty().hide()}};function isBigCity(){var a=jQuery("#province").val();if(a==1||a==2){return true}else{return false}};String.prototype.mylength=function(){var b=this.match(/[\u00FF-\uFFFF]/gi);if(!b||b==null){return this.length}var a=this.length+b.length;return a};String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};function formatToString(a){if(a!=null&&a!="null"&&a!=undefined&&a!=""&&a.length>0){return a}else{return""}}function len(e){var c=0;var b=e.split("");for(var d=0;d<b.length;d++){if(b[d].charCodeAt(0)<299){c++}else{c+=2}}return c}function showWaitInfo(b,a){jQuery("#"+b).hide();jQuery("#"+a).show()}function hideWaitInfo(b,a){jQuery("#"+b).show();jQuery("#"+a).hide()}function showWaitInfoOnInner(d,c){try{if(c==null){return}var b=document.createElement("span");b.className="waitInfo";b.id="waitInfo";b.innerHTML=d;c.innerHTML="";c.appendChild(b)}catch(a){}}function hasErrors(){var a=jQuery("#errorMsgDisplayDiv").html();
return a&&a.trim().length>10}function doShowErrors(){if(hasErrors()){YHD.alert(jQuery("#errorMsgDisplayDiv").html(),returnCart)}jQuery("#errorMsgDisplayDiv").hide()}function showCheckoutAjaxErrorPopwin(){if(jQuery("#checkoutAjaxErrorDiv").size()>0){YHD.popwin(jQuery("#checkoutAjaxErrorDiv").html(),null,null,"200px","400px");jQuery(window).scroll(function(){jQuery("#yhd_pop_win").css({top:jQuery(document).scrollTop()+jQuery(window).height()-jQuery("#yhd_pop_win").height()-500})})}}function redirectIfNotLogin(d){if(d){var f="/passport/login.do";var e="password";if(d.indexOf(f)!=-1&&d.indexOf(e)!=-1){window.location.href="/passport/login_input.do";return false}var c="URL=/not_found.do";if(d.indexOf(c)!=-1){window.location.href="/not_found.do";return false}var a="errorPageFlag";if(d.indexOf(a)!=-1){window.location.href="/product/cart.do?action=view";
return false}var b="checkoutAjaxErrorFlg";if(d.indexOf(b)!=-1){showCheckoutAjaxErrorPopwin();return false}}return true}function Round(i,digit){if(isNaN(parseFloat(i))){return"0"}if(digit==0){p=1}else{if(digit){p=Math.pow(10,digit)}else{p=100}}var mm=Math.round(i*p)/p;var strTmp=eval("'"+mm+"'");var behind="";if(strTmp.indexOf(".")>=0){behind=strTmp.substring(strTmp.indexOf(".")+1,strTmp.length);while(digit-behind.length>0){behind+="0"}strTmp=strTmp.substring(0,strTmp.indexOf(".")+1)+behind}else{for(var j=0;j<digit;j++){behind+="0"}if(digit>0){strTmp=strTmp+"."+behind}}return strTmp};var createReceiver=false;var updateReceiver=false;var submitBtnDisplay=false;var paymentSpecControl=false;var isValidCodeNeed=0;function controlSwitchWindow(a){jQuery("div[id^=inputUI]").slideUp();jQuery("#couponUI").slideUp();jQuery("div[id^=confirmUI]").slideDown();jQuery("div[id='goods_buffer_window']").slideUp();if(a==1){doModifyAddress();jQuery("#inputUI_rece").slideDown();jQuery("#confirmUI_rece").slideUp()}if(a==2){doModifyDelivery();jQuery("#confirmUI_delivery").slideUp()}if(a==3){getWLTPoints();showPaymentUI();jQuery("#confirmUI_payment").slideUp()}if(a==4){getWLTPoints();jQuery("#gatewayInfoImg").attr("src",jQuery(".pay_bank_item input:checked").val());jQuery("#tableBankList").remove();showConfirmUI()}}function hideSubmitBtn(){jQuery("#submitbtn").hide()}function showSubmitBtn(){jQuery("#submitbtn").show()
}function returnCart(){flow_step=1;renderUI();return false}function renderUI(){doModifyAddress();controlSwitchWindow(flow_step)}function initUI(){renderUI()}function toggleAddressModel(){var c=jQuery("#province").val();var b=jQuery("#city").val();var a=jQuery("#county").val();jQuery("#placeSelector").attr("provinceId",c);jQuery("#placeSelector").attr("cityId",b);if(a==null||a==""){jQuery("#placeSelector").attr("countyId",0)}else{jQuery("#placeSelector").attr("countyId",a)}jQuery("#placeSelector").attr("areaId",0);if(map_load==1){YHDPlaceSelector.initDefaultCheckedStatus();map_load=2}else{YHDMapPlaceSelector.initDefaultCheckedStatus();map_load=1}}jQuery(document).ready(function(){doShowErrors();initUI();if(flow_step==1){if(map_load==1){YHDMapPlaceSelector.initDefaultCheckedStatus()}else{YHDPlaceSelector.initDefaultCheckedStatus()
}}jQuery(".cont").hide();listenMouseArea();jQuery(document).keydown(function(b){var a;if(!b){var b=window.event}if(b.keyCode){a=b.keyCode}else{if(b.which){a=b.which}}if((a==8)&&((event.srcElement.type!="text"&&event.srcElement.type!="textarea"&&event.srcElement.type!="password")||event.srcElement.readOnly==true)){event.keyCode=0;event.returnValue=false}return true})});function submitAttachedObjectInfo(){if(!checkAttachedForm()){return false}var b="/product/updateAtttachedInfo.do";var a=$("attachedFrm").serialize();jQuery.post(b,a,updateAttachedFlag)}function updateAttachedFlag(a){redirectIfNotLogin(a);attached=true;$("attachedObjectSelect").innerHTML=a.responseText;$("attachedObjectList").hide();$("modifyAttachedLink").show();$("attachedObjectSelect").show()}function refreshValidCode(){var a=new Date();
jQuery("#validCodePic").attr("src","/checkout/confirm/GenValidCode.do?t="+a)}function submitValidCode(){var c=jQuery("#validPicValue").val();var a="/checkout/confirm/ConfirmValidCode.do";var b={rd:Math.random(),validCodeValueOfPage:c};jQuery.get(a,b,function(d){if(d.data==null){d.data=0}if(d.data==1){jQuery("#validError").hide();doSaveInvoice(0)}else{jQuery("#validError").show()}})}function submitOrder(){placeOrder(this);gotracker("2","placeOrderButton",null)}function onTypeCode(){jQuery("#validError").hide()};function doModifyDelivery(a){if(a){showWaitInfo("正在读取送货方式，请等待。。。",a)}showDeliveryUI()}function showDeliveryUI(){jQuery.post("/checkout/ship/index.do?rd="+Math.random(),"",updateDeliveryMethod)}function updateDeliveryMethod(a){if(!redirectIfNotLogin(a)){return false}else{jQuery("#inputUI_delivery").html(a);jQuery("#inputUI_delivery").slideDown();hideWaitInfo("confirm_address","confirm_address_wait");flow_step=2;setTimeout(function(){$(".tip_box").fadeOut("normal")},1500);initDeliveryMethodSelectorEvent()}}function doSaveDelivery(b){var a="/checkout/ship/confirmSaveOrderDeliveryMethod.do?rd="+Math.random();var c=getDeliveryPostParams();showWaitInfo("confirm_delivery","confirm_delivery_wait");jQuery.post(a,c,function(d){afterSaveDelivery(d)})}function afterSaveDelivery(a){jQuery("#confirmUI_delivery").removeAttr("disabled");
hideWaitInfo("confirm_delivery","confirm_delivery_wait");if(a.indexOf("DATE_ERROR")>=0){YHD.alert("很抱歉，您选择的期望收货日期不正确。");return false}if(!redirectIfNotLogin(a)){return false}else{jQuery("#confirmUI_delivery").html(a);flow_step=3;renderUI();showPaymentUI();gotracker("2","showDeliveryPage:{companyType:[1,2],companyTypeCnt:3,saleInfo:[{type:1,num:1},{type:2,num:1},{type:3,num:1}]}",null)}}function refreshShipPage(a){if(!redirectIfNotLogin(a)){return false}else{jQuery("#inputUI_delivery").html(a);flow_step=2;renderUI();setTimeout(function(){$(".tip_box").fadeOut("normal")},1500);initDeliveryMethodSelectorEvent()}}jQuery(document).ready(function(){setTimeout(function(){$(".tip_box").fadeOut("normal")},1500)});function unitOrderShip(){var a="/checkout/ship/unitOrderShip.do?rd="+Math.random();var b=getSendOrderMarkParams(1);
jQuery.get(a,b,function(c){refreshShipPage(c)})}function splitOrderShip(){var a="/checkout/ship/splitOrderShip.do?rd="+Math.random();var b=getSendOrderMarkParams(2);jQuery.get(a,b,function(c){refreshShipPage(c)})}function initDeliveryMethodSelectorEvent(){jQuery("input.delivery_radio").click(function(){var a=jQuery(this).val();var c=jQuery(this).attr("orderMark");if(a==10005){jQuery("#assignDate"+c).show();var b=jQuery(this).attr("issupport");if(b=="true"){if(jQuery("#datePickerInput"+c).val()==jQuery("#datePickerInput"+c).attr("startdate")){jQuery("#halfDay"+c).show();jQuery("#oneDayThree"+c).hide()}else{jQuery("#halfDay"+c).hide();jQuery("#oneDayThree"+c).show()}}else{jQuery("#oneDayThree"+c).show()}}else{jQuery("#assignDate"+c).hide();jQuery("#halfDay"+c).hide();jQuery("#oneDayThree"+c).hide()
}refreshOrderDeliveryFee()});jQuery("input[name=datePickerInput]").click(function(){var a=jQuery(this);showDatePicker(a)});jQuery("select.deliveryTime").unbind();jQuery("select.deliveryTime").change(function(){refreshOrderDeliveryFee()})}function showDatePicker(d){var a=jQuery(d).attr("startDate");var b=jQuery(d).attr("disabledDate");var c=jQuery(d).attr("endDate");jQuery(d).datePicker({onSelectDate:function(e,f){afterSelectDate(e,f)}}).dpSetDisabledDate(b).dpSetStartDate(a).dpSetEndDate(c)}function afterSelectDate(b,e){var f=jQuery("#"+e.id);var c=f.attr("startdate");var d=f.attr("orderMark");var a=jQuery("input[name='deliveryMethodSelector"+d+"']:checked").attr("issupport");if(a=="true"){if(b==c){jQuery("#halfDay"+d).show();jQuery("#oneDayThree"+d).hide()}else{jQuery("#halfDay"+d).hide();
jQuery("#oneDayThree"+d).show()}refreshOrderDeliveryFee()}}function refreshOrderDeliveryFee(){var a="/checkout/ship/ajaxRefreshOrderDeliveryFee.do?rd="+Math.random();var b=getDeliveryPostParams();jQuery("#confirm_delivery").attr("disabled",true);jQuery.post(a,b,function(d){jQuery("#confirm_delivery").attr("disabled",false);if(d&&d.message=="success"){var f=d.data.totalYihaodianDeliveryFee;var e=d.data.totalYihaodianAmount;var c=d.data.almostGiftFlag;refreshAlmostGiftFlag(c);jQuery("#totalYihaodianDeliveryFee").text(f);jQuery("#totalYihaodianAmount").text(e)}else{showCheckoutAjaxErrorPopwin();return false}},"json")}function refreshAlmostGiftFlag(a){var b=a-1;if(b<0){b=0}jQuery(".almostOrder").hide();jQuery(".almostOrder").eq(b).show()}function getSendOrderMarkParams(b){var a="";jQuery("input.sendOrderRadio:radio:checked").each(function(){var c=jQuery(this).val();
if(c==b){var d=jQuery(this).attr("orderMark");a+="&orderMarks="+d}});if(a.length>0){a=a.substring(1)}return a}function getDeliveryPostParams(){var a="";jQuery(".delivery_radio:checked").each(function(){var f=jQuery(this).attr("orderMark");var b="";var d="";var e="";var c="";b=jQuery(this).val();if(parseInt(b,10)==10005){d=jQuery("#datePickerInput"+f).val();if(jQuery(this).attr("issupport")=="true"&&d==jQuery("#datePickerInput"+f).attr("startdate")){e=jQuery("[name=halfDayTime"+f+"]").val()}else{e=jQuery("[name=3dayTime"+f+"]").val()}}if(jQuery("#receive_remarks"+f).size()>0){c=jQuery("#receive_remarks"+f).val();if(jQuery.trim(c)==remarkMsg){c=""}}a+="&orderMarks="+f+"&selectedDeliveryMethodIds="+b+"&receiverDates="+d+"&selectedThreeOneDays="+e+"&receive_remarks="+c});if(a.length>0){a=a.substring(1)
}return a}function remarkChange(c){var b=jQuery(c);var a=b.val();if(jQuery.trim(a)==""||jQuery.trim(a)==msg){b.val(msg)}else{}}var remarkMsg="选填，可告诉商家您对订单的特殊要求（颜色，尺码，配送方式等信息以订单信息为准，留言无效。）";function remarkInput(c){var b=jQuery(c);var a=b.val();if(jQuery.trim(a)==""||jQuery.trim(a)==remarkMsg){b.val("")}};function showAddressUI(){flow_step=1;renderUI();hideSubmitBtn()}function doSaveAddress(a){var b=jQuery("#county").val();if((b==null||b=="")&&jQuery("#detailAddress").val()&&jQuery("#city").val()>0){areaAddress()}else{doSaveOrUpdateLocation(a)}}function doSaveOrUpdateLocation(b){destroy();if(!validateLocation()){return}showWaitInfo("confirm_address","confirm_address_wait");var a=getReceiverParam();if(!a){a=""}jQuery.post("/checkout/address/saveOrUpdateReceiver.do",a,afterSaveOrUpdateLocation)}function saveAddressBeforeChangeProvince(){var a=getReceiverParam();if(!a){a=""}jQuery.post("/checkout/address/saveOrUpdateReceiver.do",a,afterSaveOrUpdateLocation)}function afterSaveOrUpdateLocation(b){if(b!=null&&parseInt(b)==-99){alert("亲爱的用户，您输入的手机或电话号码格式不正确，请重新输入!");var a=jQuery("#mobile").val();if(a!=null&&jQuery.trim(a).length>0){jQuery("#mobile").select()
}else{jQuery("#phone").select()}}else{if(b!=null&&parseInt(b)==-97){alert("亲爱的用户，您当前选择的省，市，区/县等地址信息不正确，请重新选择!");toggleAddressModel()}else{if(b!=null&&b.search("theOnlyDecisionMarksASuccessful")==-1){if(b.indexOf("checkoutAjaxErrorFlg")!=-1){window.location.href="/product/cart.do?action=view"}else{jQuery("#errorMsgDisplayDiv").html(b);doShowErrors()}return}else{jQuery("#errorMsgDisplayDiv").html("")}if(!redirectIfNotLogin(b)){return false}jQuery("#receiver_buffer_window").html(b);showWaitInfo("confirm_address","confirm_address_wait");jQuery("#confirmUI_rece").hide();updateReceiver=false;flow_step=2;renderUI();confirmDeliveryAddressTracker()}}}function getReceiverParam(){var c=jQuery("#receiverID").val();var l="";var i=jQuery("#receiverName").val().trim();var b=jQuery("#detailAddress").val().trim();
var j=jQuery("#phone").val().trim();var a=jQuery("#mobile").val().trim();var k=null;if(jQuery("#email")&&jQuery("#email").val()){k=jQuery("#email").val().trim()}var n=jQuery("#city").val();var m=jQuery("#province").val();var f=jQuery("#county").val();var d=jQuery("#area").val();var h="ALL";var g=jQuery("input[name='delivery_time']:radio:checked");if(g.size()>0){h=g.val()}var e=0;if(jQuery("#daily_address").attr("checked")){e=1}var o="";if(c==0){o+="action=create"}else{o+="receiver.id="+c;if(updateReceiver){o+="&action=update"}else{o+="&action=none"}}if(d==null||d==0){d=f}o+="&receiver.receiverName="+encodeURIComponent(i)+"&receiver.address1="+encodeURIComponent(b)+"&receiver.phone="+j+"&receiver.mobile="+a+"&receiver.provinceID="+m+"&receiver.cityID="+n+"&receiver.countyID="+f;o+="&receiver.areaID="+d;
o+="&receiver.convenientReceiveDayType="+h;o+="&receiver.defaultReceiver="+e;o+="&rd="+Math.random();if(k){o=o+"&email="+k}return o}function doModifyAddress(){if(map_load==1){YHDMapPlaceSelector.initDefaultCheckedStatus()}else{YHDPlaceSelector.initDefaultCheckedStatus()}}function showAddrInputUI(){updateReceiver=true;jQuery("#addrInputDiv").show()}function popQueryWindow(){var a="/checkout/address/openQueryPlacePage.do";jQuery.get(a,null,function(b){YHD.popwin(b,472,377);jQuery("#yhd_pop_win").bgiframe();jQuery(window).scroll(function(){jQuery("#yhd_pop_win").css({top:jQuery(document).scrollTop()+jQuery(window).height()-jQuery("#yhd_pop_win").height()-150})})})}function areaAddress(){var a=jQuery("#detailAddress").val();if((currDetailAddress!=a&&jQuery("#city").val()!=0&&isInAddressArea)||(cityChange==1&&isInAddressArea)){if(map_load==1&&isPopMap()&&manyFourPlace!=2){var b=jQuery("#detailAddress").val();
if(b&&b!=""){cityChange=0;checkDteailAddress();mapReturnResult("so")}}}}function refreshPlace(b,e,c,d,a){if(map_load==1){YHDMapPlaceSelector.updateDefaultCheckedStatus(b,e,c,d)}else{YHDPlaceSelector.updateDefaultCheckedStatus(b,e,c,d)}jQuery("#postCode").val(formatToString(a))}function searchAreaBySo(){var f=jQuery("#province").val();var b=jQuery("#city").val();var a=splitLatlng(latlng);var h=parseFloat(a[0]);var e=parseFloat(a[1]);var d=jQuery("#detailAddress").val();var c="/checkout/address/ajaxGetPlaceCodeBySo.do";var g={provinceId:f,cityId:b,lat:h,lng:e,dteailAdress:d};jQuery.post(c,g,function(i){if(i&&i.message=="success"&&i.data){var k='<option value="'+i.data.countyId+'" postcode="'+i.data.postCode+'" selected></option>';var j='<option value="'+i.data.areaId+'" postcode="'+i.data.postCode+'" selected></option>';
if(isBigCity()){jQuery("#county").html(k)}jQuery("#area").html(j);jQuery("#postCode").val(i.data.postCode)}else{popMapWindow()}},"json")}var currDetailAddress="";function getCurrAddress(){currDetailAddress=jQuery("#detailAddress").val()}var isInAddressArea=true;function listenMouseArea(){jQuery("#addressContent").mouseout(function(){isInAddressArea=false});jQuery("#addressContent").mouseover(function(){isInAddressArea=true})}function checkDteailAddress(){var h=jQuery("#province").find("option:selected").text();var e=jQuery("#city").find("option:selected").text();var a=jQuery("#county").find("option:selected").text();var d=jQuery("#detailAddress").val();if(jQuery.trim(d)==""||jQuery.trim(d)=="街道名称/编号 楼宇名称 单位 房间"){return}if(isBigCity()){var c=e;var g=h+e+d}else{var c=a;var g=h+e+a+d}var b="/checkout/address/ajaxCheckDetailAddress.do";
var f={r:Math.round(),regional:c,dteailAdress:g};jQuery.post(b,f,function(i){if(i&&i.message=="success"&&i.data){}else{jQuery("#addrError2Addr").html(d);jQuery("#addrError2Pro").html(c);jQuery("#addrError2").removeClass("none");setTimeout("cancelWarn()",5000)}},"json")}function cancelWarn(){jQuery("#addrError2").addClass("none")}function popMapWindow(){if(map_load==1&&isPopMap()&&manyFourPlace!=2){isPopMapWindowCalled=true;mapReturnResult("call")}}function mapReturnResultCallBack(){if(mapResult!=null||mapResult.length>0){if(mapResult.length>1){var a="/checkout/address/openQueryMapPage.do";jQuery.get(a,null,function(b){YHD.popwin(b,820,485);jQuery("#yhd_pop_win").bgiframe();jQuery(window).scroll(function(){jQuery("#yhd_pop_win").css({top:jQuery(document).scrollTop()+jQuery(window).height()-jQuery("#yhd_pop_win").height()-150})
})})}else{if(mapResult.length==1){ajaxGetPlaceCode()}}}else{toggleAddressModel();jQuery("#areaMessage").html("为了能准确配送您的订单，请选择您所在的详细地区！")}}function checkReceiverName(){var a=jQuery("#receiverName").val();if(a.trim()==""){jQuery("#nameError").html("请输入收货人姓名");jQuery("#nameError").attr("class","error");return false}else{if(a.mylength()>12){jQuery("#nameError").html("收货人姓名 不能超过12个字符或6个汉字");jQuery("#nameError").attr("class","error");return false}else{jQuery("#nameError").html("");jQuery("#nameError").attr("class","ok")}}return true}function textBoxPromptValue(a){a.each(function(){var b=$(this).attr("promptValue").trim();if($(this).val().trim()==""){$(this).val($(this).attr("promptValue").trim()).css("color","#ccc")}else{if($(this).val().trim()!=$(this).attr("promptValue").trim()){$(this).css("color","#666")
}}$(this).focus(function(){$(this).css("color","#666");if($(this).val().trim()==b){$(this).val("")}}).blur(function(){if($(this).val().trim()==""){$(this).val(b).css("color","#ccc")}})})}function clearPromptValue(a){a.each(function(){var b=$(this).attr("promptValue").trim();if($(this).val().trim()==b){$(this).val("").css("color","#666")}})}jQuery(init);function init(){textBoxPromptValue($(".rece_box .info_form .text"))}function destroy(){clearPromptValue($(".rece_box .info_form .text"))}function checkAddress(){var a=jQuery("#detailAddress").val();if(a.trim()==""){jQuery("#addrError").html("请输入收货地址");jQuery("#addrError").attr("class","error");return false}else{if(a.length>100){jQuery("#addrError").html("收货地址 不能超过100个字符或50个汉字");jQuery("#addrError").attr("class","error");return false}else{jQuery("#addrError").html("");
jQuery("#addrError").attr("class","ok")}}return true}function checkPhoneAndCell(){var a=jQuery("#phone").val().trim();var b=jQuery("#mobile").val().trim();if((a==""&&b=="")||(b==jQuery("#mobile").attr("promptValue").trim()&&a=="")||(a==jQuery("#phone").attr("promptValue").trim()&&b=="")){jQuery("#mobileError").html("手机和电话不能同时为空");jQuery("#mobileError").attr("class","error");return false}else{if(b!=""&&b!=jQuery("#mobile").attr("promptValue")){var c=/^\d{11}$/g;if(!b.match(c)){jQuery("#mobileError").html("手机号码格式不正确，请输入11位数字");jQuery("#mobileError").attr("class","error");return false}else{jQuery("#mobileError").html("");jQuery("#mobileError").attr("class","ok")}}else{jQuery("#mobileError").attr("class","error none")}if(a!=""&&a!=jQuery("#phone").attr("promptValue").trim()){var c=/^((\d{3,4})-)?(\d{7,8})(-(\d{1,6}))?$/;
if(!a.match(c)){jQuery("#telError").html("电话格式错误，正确格式参考：021-12345678");jQuery("#telError").attr("class","error");return false}else{jQuery("#telError").html("");jQuery("#telError").attr("class","ok")}}else{jQuery("#telError").attr("class","error none")}}return true}function checkTextValid(c){if(c==null||c.length==0){return false}var b=/[\"\'-,.()-,.，。（）\\]/gi;var d=c.replace(b,"");d=d.replace(/\s/g,"");var a=/[\"\'<>,.\/:&*^%$#@!?\\]/;if(d==null||d.length==0){return false}else{if(a.exec(c)){return false}else{return true}}}function updateSelectAddress(a){backGoogleMap();var c=0;if(!a){var b=jQuery("input.delivery_info:radio:checked");if(b.size()>0){jQuery("#receiverID").val(b.val())}else{jQuery("#receiverID").val(0)}c=jQuery("#receiverID").val();jQuery("#addrInputDiv").hide()}else{jQuery("#addrInputDiv").show();
jQuery(".adds_list").removeClass("adds_selected");jQuery("input[name='delivery_info']").attr("checked",false)}proUpdateSelectAddress(c)}function proUpdateSelectAddress(a){if(a==0){jQuery("#receiverID").val(0);jQuery("#default_province_id").val("");jQuery("#default_city_id").val("");jQuery("#default_county_id").val("");jQuery("#province").val(0);jQuery("#city").val(0);jQuery("#county").val(0);jQuery("#receiverName").val("");jQuery("#detailAddress").val("");jQuery("#mobile").val("");jQuery("#phone").val("");jQuery("input[name='delivery_time'][value='ALL']").attr("checked",true);jQuery("#daily_address").attr("checked",false);jQuery("#nameError").attr("class","none");jQuery("#mobileError").attr("class","none");jQuery("#telError").attr("class","none");jQuery("#addrError").attr("class","none");if(map_load==1){YHDMapPlaceSelector.clearDefaultCheckedStatus()
}else{YHDPlaceSelector.clearDefaultCheckedStatus()}if(pageAddressProvinceIdV2!==null&&pageAddressProvinceIdV2>0){jQuery("#province").attr("value",pageAddressProvinceIdV2);jQuery("#province").change()}init();return}else{ajaxGetGoodReceiverById(a)}}function linkToAlipay(){jQuery.post("/alipay/alipayAddress.do",{nowUrl:document.location.href},linkToAlipayFinish)}function linkToAlipayFinish(a){window.open(a)}function ajaxGetGoodReceiverById(c){var a="/checkout/address/ajaxGetGoodReceiverById.do";var b={id:c,rd:Math.random()};jQuery.get(a,b,function(e){if(e.message=="success"){var f=e.data;if(map_load==1){YHDMapPlaceSelector.updateDefaultCheckedStatus(f.provinceId,f.cityId,f.countyId,f.areaId)}else{YHDPlaceSelector.updateDefaultCheckedStatus(f.provinceId,f.cityId,f.countyId,f.areaId)}jQuery("#receiverName").val(formatToString(f.receiverName));
jQuery("#detailAddress").val(formatToString(f.address1));jQuery("#mobile").val(formatToString(f.receiverMobile));jQuery("#phone").val(formatToString(f.receiverPhone));jQuery("#email").val(formatToString(f.receiverEmail));var d=formatToString(f.convenientReceiveDayType);jQuery("input[name='delivery_time'][value='"+d+"']").attr("checked",true);if(f.isDefault==1){jQuery("#daily_address").attr("checked",true)}else{jQuery("#daily_address").attr("checked",false)}init();checkAllReceiverInfo()}else{window.location="/product/cart.do?action=view"}},"json")}function checkemail(){var a=jQuery("#email").val();a=a.trim();if(a==""){jQuery("#emailmesdiv").html("email不能为空");jQuery("#emailmesdiv").addClass("red");return false}if(!CheckEmail(a)){jQuery("#emailmesdiv").html("email格式不正确");jQuery("#emailmesdiv").addClass("red");
return false}jQuery("#emailmesdiv").html("<img src='/images/yes.gif'/>")}function CheckEmail(a){var a=a;var b=/^([a-zA-Z0-9._-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;flag=b.test(a);if(!flag){return false}return true}function checkAllReceiverInfo(){checkReceiverName();checkPhoneAndCell();checkAddress();getCurrAddress()}function validateLocation(){var d=jQuery("#receiverID").val();var g=jQuery("#receiverName").val().trim();var b=jQuery("#detailAddress").val().trim();var h=jQuery("#phone").val().trim();var a=jQuery("#mobile").val().trim();var i=null;if(jQuery("#email")&&jQuery("#email").val()){i=jQuery("#email").val().trim()}var j=jQuery("#city").val();var k=jQuery("#province").val();if(k==null){k=1}var f=jQuery("#county").val();if(d==-1){alert("请选择收货地址.");return false}if(g==""){alert("请输入收货人姓名.");
jQuery("#receiverName").focus();return false}else{if(g.mylength()>12){alert("收货人姓名 不能超过12个字符或6个汉字");jQuery("#receiverName").focus();return false}else{if(checkTextValid(g)==false){alert("收货人姓名不能为空,并且不能包含特殊字符!");jQuery("#receiverName").select();return false}}}if(b==""){alert("请输入收货地址.");jQuery("#detailAddress").focus();return false}else{if(len(b)>100){alert("收货地址 不能超过100个字符或50个汉字");jQuery("#detailAddress").focus();return false}else{if(checkTextValid(b)==false){alert("收货地址不能为空,并且不能包含特殊字符!");jQuery("#detailAddress").select();return false}}}if(k==0||j==0||f==0){alert("请选择地区.");return false}var e=0;if(jQuery("#area").size()>0){e=jQuery("#area").val()}if(e==null||parseInt(e)==0){if(jQuery("#area").size()>0&&jQuery("#area option").size()>0){alert("请选择一个四级区域.");return false}}if(h==""&&a==""){alert("手机和电话不能同时为空.");
jQuery("#mobile").focus();return false}else{if(a!=""){a=a.trim();var c=/^\d{11}$/g;if(!a.match(c)){alert("手机号码格式不正确，请输入11位数字.");jQuery("#mobile").focus();return false}}if(h!=""){h=h.trim();var c=/^((\d{3,4})-)?(\d{7,8})(-(\d{1,6}))?$/;if(!h.match(c)){alert("电话格式错误，正确格式参考：021-12345678.");jQuery("#phone").focus();return false}}}if(i){if(i==""){alert("email不能为空");jQuery("#email").focus();return false}if(!CheckEmail(i)){alert("email格式不正确");jQuery("#email").focus();return false}}if(k!=pageAddressProvinceIdV2){if(jQuery("#checkoutAddressChangeCity").size()>0){jQuery("#popDiv").removeClass("none");YHD.popwin(jQuery("#checkoutAddressChangeCity").html(),"470px","200px")}return false}return true}function addAlipayAddree(c,b,d,a){jQuery("#new_address").attr("checked","checked");proUpdateSelectAddress(0);
jQuery("#receiverName").val(b);jQuery("#detailAddress").val(c);jQuery("#mobile").val(d);jQuery("#phone").val(a)}function myAddressHideShow(){if(jQuery("div.row:visible").size()>5){jQuery("div.row:gt(4)").hide();jQuery("#showAddress").html("【显示所有收货地址】 &nbsp;&nbsp;")}else{if(jQuery("div.row:visible").size()<=5&&jQuery("div.row").size()>5){jQuery("div.row:gt(4)").show();jQuery("#showAddress").html("【隐藏部分收货地址】 &nbsp;&nbsp;")}}}function myAddressHover(){jQuery("div.row").hover(function(){if(!jQuery(this).hasClass("row_hover")){jQuery(this).addClass("row_hover");jQuery(this).find("span").show()}},function(){if(jQuery(this).hasClass("row_hover")){jQuery(this).removeClass("row_hover");jQuery(this).find("span").hide()}})}function backGoogleMap(){var a=jQuery("div.row :radio:checked");if(google_config==1&&a.val()>0){if(map_load==2){map_load=1
}jQuery("#areaMessage").hide();if(map_load==1){YHDMapPlaceSelector.initDefaultCheckedStatus()}else{YHDPlaceSelector.initDefaultCheckedStatus()}}}function addrHighLight(a){if(jQuery(a).is(":checked")){jQuery(a).parents(".adds_list").addClass("adds_selected").siblings(".adds_list").removeClass("adds_selected")}}function delReceiver(b){var a="http://my.yihaodian.com//member/address/ajaxDeleteAddress.do";jQuery.ajax({type:"get",url:a,data:{"goodReceiver.id":b,rd:Math.random()},dataType:"jsonp",error:function(){},success:function(c){if(c.ERROR){jQuery("#delete_tip_"+b).addClass("none");alert("网络异常，请稍后再试。")}else{jQuery("#address_"+b).remove();jQuery("#addrMaxInfo").remove();jQuery("#receiverID").val("-1");jQuery("p:.adds_list").each(function(d){if(d<3){jQuery(this).show()}})}}})}function setDefaultReceiver(c){var a="http://my.yihaodian.com//member/address/ajaxDefaultAddress.do";
var b={"goodReceiver.id":c,rd:Math.random()};jQuery.get(a,b,function(e){if(e.ERROR){alert("网络异常，请稍后再试。")}else{jQuery("#daily_address").attr("checked","checked");jQuery("a[id^='setDefaultUi_']").removeClass("none");jQuery("span[class='addre']").remove();jQuery("span[class='success']").remove();jQuery("#setDefaultUi_"+c).addClass("none");var f=jQuery("#setDefaultUi_"+c);f.addClass("none");var d=f.parent();f.parent().append('<span class="addre">常用地址</span>');f.parent().append('<span class="success">设置成功！</span>');setTimeout(function(){d.children(".success").fadeOut(400)},1500)}},"jsonp")}function showAllAddress(){jQuery(".adds_list").show();jQuery("#btn_show").hide();jQuery("#btn_away").show()}function hideAddress(){jQuery(".adds_list").each(function(){var a=jQuery(this);var b=a.attr("idx");if(b>3){a.hide()
}});jQuery("#btn_show").show();jQuery("#btn_away").hide()};var geocoder;var map;var myOptions;var mapResult;var latlng;function initialize(){try{geocoder=new google.maps.Geocoder()}catch(a){}var b=new google.maps.LatLng(31.2,121.4);myOptions={zoom:8,center:b,mapTypeId:google.maps.MapTypeId.ROADMAP}}function mapReturnResult(b){initialize();var a=jQuery("#province").find(":selected").text();var f=jQuery("#city").find(":selected").text();var e="";if(!isBigCity()){e=jQuery("#county").find(":selected").text()}var d=jQuery("#detailAddress").val();var c=a+f+e+d;if(geocoder){geocoder.geocode({address:c},function(h,g){if(g==google.maps.GeocoderStatus.OK){mapResult=h;if(h.length>0){latlng=h[0].geometry.location}if(b=="call"){mapReturnResultCallBack()}else{if(b=="so"){searchAreaBySo()}}}else{if(g==google.maps.GeocoderStatus.ZERO_RESULTS){toggleAddressModel();
jQuery("#areaMessage").html("为了能准确配送您的订单，请选择您所在的详细地区！");mapResult=null}else{mapResult=null}}})}else{mapResult=null}}function codeAddress(){var a=jQuery("#province").find(":selected").text();var e=jQuery("#city").find(":selected").text();var d="";if(!isBigCity()){d=jQuery("#county").find(":selected").text()}var c=jQuery("#detailAddress").val();var b=a+e+d+c;if(!geocoder){initialize()}if(geocoder){geocoder.geocode({address:b},function(k,h){if(h==google.maps.GeocoderStatus.OK){myOptions.zoom=12;map=new google.maps.Map(document.getElementById("map_content"),myOptions);map.setCenter(k[0].geometry.location);var g=k.length;if(k.length>9){g=9}for(var j=0;j<g;j++){var f=new google.maps.Marker({map:map,position:k[j].geometry.location,title:k[j].formatted_address});showGoogleAddress(k[j].formatted_address,j)
}}else{toggleAddressModel();jQuery("#areaMessage").html("为了能准确配送您的订单，请选择您所在的详细地区！")}})}}function placeMarker(b){var c=new google.maps.LatLng(b);var a=new google.maps.Marker({position:b,map:map});map.setCenter(b)}function splitLatlng(b){$latlng=b.toString();$latlng=$latlng.substr(1,$latlng.length-2);var a=$latlng.split(",",2);return a}function showGoogleAddress(b,f){var c=document.getElementById("map_info");var e=document.createElement("li");var a=(f==0)?"checked":"";var g=b;var d="<label><strong><em>"+(f+1)+'</em><input name="map_add_line" type="radio" value="'+latlng+'" add="'+g+'" '+a+"/></strong>"+g+"</label>";e.innerHTML=d;c.appendChild(e)}function selectMapAddress(){jQuery(".ap_add strong").html(jQuery("input[name='map_add_line']:checked").attr("add"));jQuery(".ap_add").show()}function cancelSelect(){jQuery(".ap_add").hide();
jQuery(".ap_add strong").html("")}function ajaxGetPlaceCode(){if(!latlng||latlng==""){latlng=jQuery("input[name='map_add_line']:checked").val()}var a=splitLatlng(latlng);var g=parseFloat(a[0]);var d=parseFloat(a[1]);var b=jQuery("#city").val();var f="";if(!isBigCity()){f=jQuery("#county").val()}var c="/checkout/address/ajaxGetPlaceCodeByLatlng.do";var e={cityId:b,countyId:f,lat:g,lng:d};jQuery.post(c,e,function(h){if(h&&h.message=="success"&&h.data){var j='<option value="'+h.data.countyId+'" postcode="'+h.data.postCode+'" selected>'+h.data.countyCname+"</option>";var i='<option value="'+h.data.areaId+'" postcode="'+h.data.postCode+'" selected>'+h.data.areaCname+"</option>";if(isBigCity()){jQuery("#county").html(j)}jQuery("#area").html(i);jQuery("#postCode").val(h.data.postCode)}else{toggleAddressModel();
jQuery("#areaMessage").html("为了能准确配送您的订单，请选择您所在的详细地区！")}},"json")}function isPopMap(){if(isBigCity()){return true}else{if(!isBigCity()&&manyFourPlace==1){return true}else{return false}}};function getWLTPoints(){if(hasPingAnCookie&&hasPingAnCookie==1){jQuery("#wltPoints_p1").show();jQuery.post("/pingan/queryPointsAmount.do?rd="+Math.random(),"",updatePoints)}}function updatePoints(d){if(!redirectIfNotLogin(d)){return false}var i=d;if(i){var c=i.split("=");if(c.length>0){var j=c[0];if(j==1){var a=c[1];var g=a.split(",");var h=g[0];var f=g[1];var b=jQuery("#wltPoints");if(b.size()>0){b.html(h);b.show();jQuery("#wltPoints_waiting").hide()}var e=jQuery("#wltPoints1");if(e.size()>0){e.html(h);e.show();jQuery("#wltPoints_waiting1").hide()}}}}}function requestPaymentMethodsEx(){var a="/checkout/payselect/requestAllPaymentMethod.do?rd="+Math.random();var b={};jQuery.get(a,b,afterRequestPaymentMethodsEx)}function afterRequestPaymentMethodsEx(a){if(!redirectIfNotLogin(a)){return false
}jQuery("#inputUI_payment").html(a);jQuery("#inputUI_payment").slideDown();getWLTPoints();initPayMethodPageEvent();showPaymentPageTracker()}function getCouponList(){jQuery.post("/checkout/confirm/getOrderUnit.do?rd="+Math.random(),"",afterGetCouponList)}function afterGetCouponList(a){if(!redirectIfNotLogin(a)){return false}jQuery("#couponUI").html(a);jQuery("#couponUI").slideDown()}function showPaymentUI(){flow_step=3;requestPaymentMethodsEx();getCouponList()}function valdiatePaymentMethod(){var a=jQuery("input[name='payment']:checked");if(a.size()==0){alert("请选择付款方式.");return false}var e=jQuery("#paymentMethodID").val();if(e==""){alert("请选择付款方式.");return false}var c=jQuery("#paymentType").val();if(c==4){var b=jQuery("#bank").val();if(b==0){alert("请选择转账的银行.");return false}}if(c==1){var d=jQuery("#gatewayID").val();
if(jQuery.trim(d)==""||d=="-1"){popBankList();return false}}return true}function validateUser(){var a="/checkout/confirm/checkoutUser.do?rd="+Math.random();jQuery.ajax({type:"get",url:a,async:false,success:function(b){jQuery("#btn").hide();jQuery("#confirm_goods1").hide();if(b.data.cheatingLevel==1){jQuery("#validCodeCheck1").show();jQuery("#btn").show();jQuery("#btn1").hide()}else{jQuery("#btn").hide();jQuery("#btn1").show()}}})}function doSavePayment(b){var c=jQuery.trim(jQuery("#defaultAccountAmount").val());var a=jQuery.trim(jQuery("#payByAccount").val());if(!valdiatePaymentMethod()){return}doSavePaymentMethod()}function doSavePaymentMethod(){var a="/checkout/payselect/confirmPaymentMethod.do?paymentMethodID="+jQuery("#paymentMethodID").val()+"&paymentGatewayID="+jQuery("#gatewayID").val();
a=a+"&rd="+Math.random();showWaitInfo("confirm_payment","confirm_payment_wait");jQuery.post(a,"",afterSavePaymentMethod)}function afterSavePaymentMethod(e){jQuery("#confirm_payment").removeAttr("disabled");if(!redirectIfNotLogin(e)){return false}var d=jQuery("#paymentType").val();var a=jQuery("#paymentMethodName").val();jQuery("#confirmUI_payment").html(e);jQuery("#paymentNameInfo").html(a);if(d==1){var f=jQuery(".pay_bank_item input:checked");var c=f.attr("desc");var b=f.val();jQuery("#gatewayInfoImg").attr("src",b);jQuery("#gatewayInfoImg").show();if(jQuery.trim(c)!=""){jQuery("#gatewayDesc").html(c+"，")}jQuery("#confirmBankInfo").html(jQuery("#bankInfo2").html())}else{jQuery("#confirmBankInfo").attr("class","none")}jQuery("#yhd_pop_win").html("");gotracker("2","doSavePaymentButton",null);
hideWaitInfo("confirm_payment","confirm_payment_wait");showSubmitBtn();flow_step=4;renderUI()}function showNewInvoiceDiv(){var a="/checkout/confirm/ajaxDecideInvoiceShow.do";a=a+"?rd="+Math.random();jQuery.post(a,"",afterShowNewInvoiceDiv)}function afterShowNewInvoiceDiv(a){jQuery("#orderInvoiceDiv").html(a)}function popBankList(){if(jQuery("#tableBankList").size()>0){YHD.popwin(jQuery("#tableBankList").html(),"658px","300px");var a=jQuery("#gatewayID").val();var b=jQuery("#bank_"+a);if(b.size()>0){jQuery("input[id^='bank_']").attr("checked",false);b.attr("checked",true);if(jQuery(".pay_bank_item input:checked").length>0){jQuery(".pay_bank_item").removeClass("current");b.parent().addClass("current")}}}return false}function initPayMethodPageEvent(){var g=jQuery(".pay_bank_item input:checked");
if(g!=null&&g.size()>0){var a=g.val();var f=g.attr("bankName");var b=g.attr("desc");jQuery("#gatewayImageStr").val(a);jQuery("#selectedBankImg").attr("src",a);if(jQuery.trim(b)!=""){b+="，"}jQuery("#bankDesc").html(b);jQuery("#bankName").html(f)}var e=jQuery(":radio[name='paymentMethodIDTmp']:checked");if((e==null||e.size()==0)){var c=jQuery(":radio[name='paymentMethodIDTmp']:eq(0)");var d=c.attr("id");if(d=="paymentMethodIDTmp4"&&(g==null||g.size()==0)){}else{c.click()}}}function paymentMethodSelect(c){if($(".radio_select input:checked").length>0){$(".delivery_box .radio_select").removeClass("current_p");$(c).parent().addClass("current_p");var a=$(c).attr("vMethodType");jQuery("#paymentType").val(a);jQuery("#paymentMethodID").val($(c).attr("vMethodId"));jQuery("#paymentMethodName").val($(c).attr("vMethodName"));
if(a==1){var b=jQuery(".pay_bank_item input:checked");if(b.size()==0){popBankList()}}}}function bankSelect(a){if(jQuery(".pay_bank_item input:checked").length>0){jQuery(".pay_bank_item").removeClass("current");jQuery("#"+a).parent().addClass("current")}setBank()}function initPaymentPage(){var c=jQuery(".delivery_box .radio_select .text_sorry em");var a=jQuery(".delivery_box .radio_select .product_win");var d=jQuery(".delivery_box .radio_select .region");var b=jQuery(".delivery_box .radio_select .region_tip");a.find(".product_list").each(function(){if(jQuery(this).find(".product_item").length>2){jQuery(this).css("height","145px")}});a.find(".product_list").each(function(){jQuery(this).find(".product_item").last().css({"margin-bottom":"0",border:"0 none"})});c.hover(function(){jQuery(this).css({position:"relative"});
a.eq(c.index(this)).show().siblings(".product_win").hide();a.find(".close").click(function(){jQuery(this).parent().hide()})},function(){jQuery(this).css({position:"static"});a.hide()});b.hide();d.hover(function(){b.eq(d.index(this)).show().siblings(".region_tip").hide()},function(){b.hide()});jQuery(".delivery_box .radio_select input:checked").parent().addClass("current_p");jQuery(".pay_bank_item input:checked").parents(".pay_bank_item").addClass("current")}function setBank(){var d=jQuery(".pay_bank_item input:checked");var c=jQuery(d).attr("bankId");var a=jQuery(d).attr("value");var b=jQuery(d).attr("bankName");var e=jQuery(d).attr("desc");jQuery("#gatewayImageStr").val(a);jQuery("#gatewayID").val(c);jQuery("#selectedBankImg").attr("src",a);if(jQuery.trim(e)!=""){e+="，"}jQuery("#bankDesc").html(e);
jQuery("#bankName").html(b);jQuery("#bankInfo").attr("class","des");jQuery("#bankInfo2").attr("class","none");jQuery("#bankListClose").click()};function doSaveByAccount(){var l=0;var o=0;if(jQuery("#balance")){l=parseFloat(jQuery("#balance").html());var k=jQuery("#payByAccount").val();if(k==""){k="0"}var p=/\d+\.?\d*/g;if(!k.match(p)){alert("请输入数字.");jQuery("#payByAccount").empty();jQuery("#payByAccount").focus();return false}var p=/^\d+\.?\d{0,2}$/g;if(!k.match(p)){alert("请输入的数值在两位小数点以内");return false}o=parseFloat(k);if(o>l){alert("帐户余额不足.");jQuery("#payByAccount").focus();return false}var m=parseFloat(jQuery("#realPayableAmount").html());var n=parseFloat(jQuery("#order_paidByAccount").html())+parseFloat(jQuery("#order_paidByCard").html());if(o>(m+n)){alert("输入的账号支付金额不能大于应付金额.");jQuery("#payByAccount").focus();return false}}var i="/checkout/payselect/needSmsCheck.do";var j="payByAccount="+k;jQuery.post(i,j,afterNeedSmsCheck)}function afterNeedSmsCheck(c){var d=c.split(":");
if(jQuery.trim(d[0])=="1"){alert("请先绑定手机");window.location.href=URLPrefix.my+"/member/bind/bind.do"}else{if(jQuery.trim(d[0])=="2"){initMobileUI(d[1])}else{if(jQuery.trim(d[0])=="0"){doSubmitSaveByAccount(d[0])}}}}function doSendValidCodeToUserBindMobile(){jQuery.post("/SMSVali/SMSSendValidCodeToUserBindMobile.do",null,afterSendValidCodeToUserBindMobile)}function afterSendValidCodeToUserBindMobile(b){ret=b;if(ret=="success"){alert("验证码已成功发送到您的手机，请注意查收。");restartTimer()}else{if(ret=="too fast"){alert("请稍后!每次发送间隔不能小于一分钟。")}else{if(ret=="overflow times"){alert("您今天已验证5次，无法再验证。")}else{alert("服务器忙，请稍后再试")}}}}function doSubmitSaveByAccount(j){var i=jQuery("#payByAccountValidCode").val();if(jQuery.trim(i)==""&&j!="0"){jQuery("#validCodeUIError").html("请输入验证码");return}var h=jQuery("#payByAccount").val();
if(h==""){h="0"}var f="/checkout/payselect/savePaybyAccount.do";var g="payByAccount="+h+"&vaildCode="+i;jQuery.post(f,g,afterPaybyAccount)}function afterPaybyAccount(c){if(!redirectIfNotLogin(c)){return false}if(c!=""){var d=c.split(":");if(jQuery.trim(d[0])=="1"){alert("请先绑定手机");window.location.href=URLPrefix.my+"/member/bind/bind.do"}else{if(jQuery.trim(d[0])=="2"){showMobileValidError()}else{alert(c);jQuery("#validCodeUI").click()}}}else{jQuery("#phone_verify_cancel").click();jQuery("#zh").css("display","none");doGetAmountList()}}function doSaveByCard(){var j=0;var k=0;if(jQuery("#balance")){j=parseFloat(jQuery("#balance2").html());var i=jQuery("#payByCard").val();if(i==""){i="0"}var l=/\d+\.?\d*/g;if(!i.match(l)){alert("请输入数字.");jQuery("#payByCard").empty();jQuery("#payByCard").focus();
return false}k=parseFloat(i);if(k>j){alert("礼品卡余额不足.");jQuery("#payByCard").focus();return false}}var g="/checkout/payselect/savePaybyCard.do";var h="payByAccount="+k;jQuery.post(g,h,afterPaybyCard)}function afterPaybyCard(b){if(!redirectIfNotLogin(b)){return false}if(b!=""){alert(b)}else{jQuery("#zh2").css("display","none");doGetAmountList()}}function timer(e){var d=parseInt(document.getElementById(e).innerHTML)-1;var f=setInterval(function(){document.getElementById(e).innerHTML=d;d--;if(d==-1){clearInterval(f);$(".label_right a").replaceWith("<a href='javascript:void(0);' onClick='doSendValidCodeToUserBindMobile();'><span>重新发送验证码</span></a>")}},1000)}function restartTimer(){$(".label_right a").replaceWith("<a><span>(<i id='verifyTime'>60</i>秒后可重新发送) </span></a>");timer("verifyTime")}function showMobileValidError(){jQuery("#mobileValidError").html("验证码有误，请重新输入！");
jQuery("#mobileValidError").css("display","block")}function initMobileUI(b){YHD.popwin(jQuery("#payByAccountVerifyMobileUI").html(),"352px","220px");jQuery("#cellPhone").html(b);$(".label_right input").focus(function(){var a=$(".label_right input").val();if(a=="效验码是6位数字"){$(this).attr("value","")}$(this).css("color","#000");$(".errorMes").hide()});$(".label_right input").blur(function(){var d=$(".label_right input").val();d=d.replace(/(^\s*)|(\s*$)/g,"");if(d.length==0){$(this).attr("value","效验码是6位数字").css("color","#ccc")}else{if("效验码是6位数字"!=d&&((d.length>0&&d.length!=6)||!d.match(/^\d+$/))){$(this).attr("value",d);showMobileValidError()}}var a=$(".label_right input").val();if(a==""||"效验码是6位数字"==a){$(this).attr("value","效验码是6位数字").css("color","#ccc")}else{$(this).attr("value",d).css("color","#000")
}});doSendValidCodeToUserBindMobile()};var submitted=false;function submitWlt(a){if(submitted){YHD.alert("正在处理支付请求，请不要重复请求");return}window.location="/pingan/redeemPoint.do?orderCode="+a;submitted=true}function submitWlt2(a,b){if(submitted){alert("正在处理支付请求，请不要重复请求");return}submitted=true;window.location.replace("/product/confirmOrder!selectGateWay.do?paymentMethodId="+b+"&myOrderId="+a)}function doPay(c,b,a){$("#currGateWayReturnUrl").val(a);window.open("/product/confirmOrder!selectGateWay.do?gateWayId="+c+"&myOrderId="+b);YHD.popwinId("pay_wait_win","close")}function finishPay(){var a=$("#currGateWayReturnUrl").val();if(a&&a!=""){window.location.href="/"}else{$(".close").click()}}function problemPay(a){window.location.href="/product/confirmOrder!payProblem.do?rd="+Math.random()+"&myOrderId="+a};function placeOrder(b){if(hasErrors()){doShowErrors();return}if(attachedObjectsSize>0&&attached!=true){alert("请保存附加信息");return}var a=(jQuery("#remainToPay")&&jQuery("#remainToPay").val()<=0);var c=jQuery("#paymentListDiv")&&jQuery("#paymentListDiv").css("display")!="none";if(hasErrors()){doShowErrors();return}waitForSubmitOrder();if(needIntegralV2>0){jQuery.post("/checkout/confirm/checkUserPoint.do?rd="+Math.random(),"",afterCheckUserPoint)}else{checkStock()}}function checkStock(){jQuery.post("/checkout/confirm/checkAllOrders.do?rd="+Math.random(),"",afterCheckStock)}function afterCheckStock(c){if(!redirectIfNotLogin(c)){return false}var d=c;if(d){d=d.trim()}if(d&&d=="sessionOrderTimeOut"){alert("由于您长时间没有确认订单导致订单信息超时，请返回到购物车重新提交订单。");window.location="/product/cart.do?action=view";return}if(d&&d.length>10){unWaitForSubmitOrder();
jQuery("#errorMsgDisplayDiv").html(c);doShowErrors()}else{var a="";a+="&orderID=1";var e=jQuery("#rdCheck").val();var f=jQuery("#gatewayID").val();var b="/product/confirmOrder!saveOrder2.do?rdCheck="+e+"&rd="+Math.random()+"&gateWayId="+f;b+=a;window.location=b}}function doGetAmountList(){jQuery.post("/checkout/confirm/getOrderUnit.do?rd="+Math.random(),"",afterGetProductList)}function afterGetProductList(a){if(!redirectIfNotLogin(a)){return false}jQuery("#couponUI").html(a);jQuery("#payableAmount").html(jQuery("#realPayableAmount").html())}var chooseInvoiceType=2;function doSaveInvoice(){var m="";var c=jQuery("#needInvoice");var f=0;var k=true;if(jQuery("#needInvoice").attr("checked")==true){var j=jQuery("#headType option:selected").val();var h=jQuery("#invoiceContent").val();if(j=="-1"){j=jQuery("#normal_head").val()
}var d=jQuery("input[name=invoiceType][checked]").val();if(chooseInvoiceType==2){if(j.trim()!=""){if(j.length>50){alert("发票抬头不能超过50个字符");jQuery("#normal_head").focus();k=false}if(h=="请选择"){alert("请选择发票内容");k=false}f=1;if(m!=""){m+="&"}m+="needInvoice="+f+"&invoiceTitle="+encodeURI(j)+"&invoiceContent="+encodeURI(h)+"&invoiceType=2"}else{if(jQuery("#needInvoice").attr("checked")==true){alert("请填写您索取发票的抬头")}k=false}}else{if(chooseInvoiceType==3){var b=jQuery("#vatCompanyNameText").val();var i=jQuery("#vatTaxpayerText").val();var a=jQuery("#vatCompanyAddressText").val();var g=jQuery("#vatCompanyPhoneText").val();var l=jQuery("#vatBankAccountText").val();var e=jQuery("#vatDeliveryAddressText").val();if(b.trim()==""){jQuery("#vatCompanyName").attr("class","wrong");k=false;return}else{jQuery("#vatCompanyName").attr("class","none")
}if(i.trim()==""){jQuery("#vatTaxpayer").attr("class","wrong");k=false;return}else{jQuery("#vatTaxpayer").attr("class","none")}if(a.trim()==""){jQuery("#vatCompanyAddress").attr("class","wrong");k=false;return}else{jQuery("#vatCompanyAddress").attr("class","none")}if(g.trim()==""){jQuery("#vatCompanyPhone").attr("class","wrong");k=false;return}else{jQuery("#vatCompanyPhone").attr("class","none")}if(l.trim()==""){jQuery("#vatBankAccount").attr("class","wrong");k=false;return}else{jQuery("#vatBankAccount").attr("class","none")}if(e.trim()==""){jQuery("#vatDeliveryAddress").attr("class","wrong");k=false;return}else{jQuery("#vatDeliveryAddress").attr("class","none")}f=1;if(m!=""){m+="&"}m+="needInvoice="+f+"&vatCompanyName="+encodeURI(b)+"&vatTaxpayer="+encodeURI(i)+"&vatCompanyAddress="+encodeURI(a)+"&vatCompanyPhone="+encodeURI(g)+"&vatBankAccount="+encodeURI(l)+"&vatDeliveryAddress="+encodeURI(e)+"&invoiceType=3"
}else{alert("请选择发票类型")}}}if(k){if(m!=""){m+="&"}invoceControl=false;m+="&rd="+Math.random();jQuery("#next").attr("disabled",true);jQuery.post("/product/confirmOrder!saveInvoice.do",m,afterSaveInvoice)}}function afterSaveInvoice(a){if(!redirectIfNotLogin(a)){return false}if(a!=null){document.getElementById("rdCheck").value=a;submitOrder();jQuery("#newInvoiceDiv").css("display","none")}}function showHiddenInvoice(a){if(jQuery("#needInvoice").attr("checked")){invoceControl=true;jQuery("#newInvoiceDiv").css("display","block")}else{invoceControl=false;jQuery.post("/checkout/confirm/canceledInvoice.do");jQuery("#newInvoiceDiv").css("display","none")}}function showYaoWangDisplay(a){if(jQuery("#needInvoice").attr("checked")){jQuery("#yaowangDisplay").css("display","inline-block")}else{jQuery("#yaowangDisplay").css("display","none")
}}function chooseOrdinary(){chooseInvoiceType=2;jQuery(".zzs_fp").hide();jQuery(".normal_fp").show()}function chooseVTA(){chooseInvoiceType=3;jQuery(".normal_fp").hide();jQuery(".zzs_fp").show()}function chooseHead(b){var a=jQuery("#headType option:selected").val();if(a=="个人"){jQuery("#normal_head").hide()}else{jQuery("#normal_head").show()}}function clickNormalHead(b){var a=jQuery(b).val();if(a=="单位名称"){jQuery(b).val("")}}function enableNext(){jQuery("#next").attr("disabled",false)}function checkUserPoint(){jQuery.post("/checkout/confirm/checkUserPoint.do?","",afterCheckUserPoint)}function afterCheckUserPoint(a){checkStock()}function checkPoints(){var a=parseFloat(jQuery("#needPoints").html());a=a.toFixed(2);jQuery("#next").attr("disabled",true);jQuery.post("/pingan/queryPointsAmount.do?rd="+Math.random(),"",popPoints)
}function popPoints(e){if(!redirectIfNotLogin(e)){return false}var b=parseFloat(jQuery("#needPoints").html());var j=e;var i=-1;if(j){var d=j.split("=");if(d.length>0){var l=d[0];if(l==1){var a=d[1];var h=a.split(",");i=h[0];var g=h[1];var c=document.getElementById("wltPoints");if(c){c.innerHTML=i;jQuery("#wltPoints").css("display","");jQuery("#wltPoints_waiting").css("display","none")}var f=document.getElementById("wltPoints2");if(f){f.innerHTML=i;jQuery("#wltPoints2").css("display","");jQuery("#wltPoints2_waiting").css("display","none")}}}}var k=jQuery("#paymentListDiv")&&jQuery("#paymentListDiv").css("display")!="none";if(i==-1&&k){jQuery("#next").attr("disabled",true);alert("无法获取您的万里通积分信息，请稍后再试。");return}if(b>i&&k){jQuery("#next").attr("disabled",true);alert("您的万里通积分不足,当前您的万里通积分为:"+i)}else{jQuery("#next").attr("disabled",false)
}}function getOrderProducts(){jQuery.post("/checkout/confirm/getOrderProducts.do?rd="+Math.random(),"",afterGetOrderProducts)}function afterGetOrderProducts(a){if(!redirectIfNotLogin(a)){return false}jQuery("#productListDiv").html(a);clearWaitInfo()}function waitForSubmitOrder(){jQuery("body").block({message:'<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td width="73%" height="50" align="center" class="font14"><img src="http://image.yihaodian.com/images/wait_loading.gif"/></td></tr><tr><td height="25" align="center" class="font14">您的订单正在处理中,请稍候...</td></tr></table>',css:{padding:0,margin:0,width:"25%",height:"10%",border:"5px solid #FFCC00",opacity:0.9,backgroundColor:"#FEFFDF"},overlayCSS:{backgroundColor:"#000",opacity:0.1,cursor:"default"}})}function unWaitForSubmitOrder(){jQuery("body").unblock()
}function showConfirmUI(){jQuery.post("/checkout/confirm/confirmOrderProducts.do?rd="+Math.random(),"",function(a){jQuery("#confirm_order_products").html(a);jQuery("div[id='goods_buffer_window']").slideDown();showNewInvoiceDiv();validateUser()})}function saveInvoiceChecked(a){jQuery.post("/checkout/confirm/saveInvoiceChecked.do?needInvoice="+a.checked+"&rd="+Math.random(),"",function(b){})};function showDetail(b,c){if(!b){return}var a=c.clientX+document.documentElement.scrollLeft;var d=c.clientY+document.documentElement.scrollTop;document.getElementById("div"+b).style.top=(d-5)+"px";document.getElementById("div"+b).style.left=(a-5)+"px";document.getElementById("div"+b).style.display="block"}function closeIt(a){if(!a){return}jQuery("#detail"+a).css("display","none")}function initMenu(a){ul=jQuery("#detail"+a);li=ul.getElementsByTagName("li");for(i=0;i<li.length;i++){li[i].onmouseover=function(){try{jQuery("#div"+a).css("display","block")}catch(b){}};li[i].onmouseout=function(){try{jQuery("#div"+a).css("display","none")}catch(b){}}}}function clearType(a){jQuery("input[name^=type]:not([id^=type"+a+"coupon]):checked").each(function(){jQuery(this).attr("checked",false)})}function checkCoupon(){jQuery("#errorArea").hide();
var a="";a=jQuery.trim(jQuery("#couponNumber").val());if(!a||a==""){alert("请输入抵用券号");return}jQuery.post("/product/checkCoupon.do",{"coupon.number":a},updateCoupon)}function updateCoupon(d){if(!redirectIfNotLogin(d)){return false}var e=d;if(e!=""){var c=e.split("=");var a=c[0];var f=c[1];if(a=="0"){jQuery("#errorArea").html("");jQuery("#errorArea").hide();jQuery("#couponAmount").html(f)}else{jQuery("#errorArea").html(e);jQuery("#errorArea").show();jQuery("#couponAmount").html("0")}}if(jQuery("#errorArea").html()!=""){return}var b="";if(jQuery("#addCouponNumber").size()>0){b=jQuery.trim(jQuery("#addCouponNumber").val())}else{b=jQuery.trim(jQuery("#couponNumber").val())}if(b.trim()!=""){jQuery.post("/product/addCoupon.do",{couponNumber:b},showCouponInfo)}else{alert("\u8bf7\u8f93\u5165\u62b5\u7528\u5238\u53f7\u7801");
return}}function removeCoupons(){jQuery.post("/product/removeCoupon.do","",afterRemoveCoupons)}function afterRemoveCoupons(a){if(a){showCouponInfo(a);var b=a.split("==");if(b[0]=="0"){requestPaymentMethodsEx()}}}function showCouponInfo(b){if(!redirectIfNotLogin(b)){return false}var a=b;if(a){var c=a.split("==");if(c[0]=="0"){doGetAmountList();jQuery("#errorArea").html("");jQuery("#errorArea").hide();jQuery("#couponArea").html(c[1])}else{if(c[0]=="-2"){jQuery("#couponHiddenArea").html(c[1]);YHD.popwin(jQuery("#verifyMobileUI").html(),"278px","170px")}else{jQuery("#errorArea").html(c[1]);jQuery("#errorArea").show()}}}}function addCoupon(){checkCoupon()}function addCouponsConfirm(){var a="";var b=jQuery("input[id*=coupon]:checked");if(b.size()==0){alert("请选择抵用券");return}b.each(function(){a=a+jQuery(this).val()+","
});jQuery.post("/product/addCoupon.do",{couponNumber:a},showCouponInfo)}function addCoupons(){var a="";jQuery("input[id*=coupon]:checked").each(function(){a=a+jQuery(this).val()+","});if(a==""){a=jQuery("#couponNumber").val()}jQuery.post("/product/addCoupon.do",{couponNumber:a},showCouponInfo)}function couponsDefVal(a){if(a.value=="\u8f93\u5165\u60a8\u7684\u62b5\u7528\u5238\u7f16\u7801"){a.value="";jQuery("#couponNumber").css("color","black")}}function showFloatTheseProduct(a){clearTimeout(floatTheseProductTimeout);jQuery("div[id^='ap_titlebox_']").not("#ap_titlebox_"+a).hide();jQuery("#titlemenu_"+a).removeClass();jQuery("#titlemenu_"+a).addClass("ap_titlebox_menu_off");jQuery("#ap_titlebox_"+a).show();if(jQuery(window).width()-jQuery("#titlemenu_"+a).offset().left<472){jQuery("#ap_titlebox_"+a).css("left",jQuery("#titlemenu_"+a).offset().left-397+"px");
jQuery("#ap_titlebox_"+a).css("top",jQuery("#titlemenu_"+a).offset().top+24+"px")}else{jQuery("#ap_titlebox_"+a).css("left",jQuery("#titlemenu_"+a).offset().left+"px");jQuery("#ap_titlebox_"+a).css("top",jQuery("#titlemenu_"+a).offset().top+24+"px")}}function hideFloatTheseProduct(a){floatTheseProductTimeout=setTimeout("jQuery('#ap_titlebox_"+a+"').hide()",100);jQuery("#titlemenu_"+a).removeClass();jQuery("#titlemenu_"+a).addClass("ap_titlebox_menu_on")}function check_mobile(){var a=document.getElementById("verifyMobile").value;if(a==""){alert("请输入手机号码!");return false}var b=/^(1)\d{10}$/;if(!b.test(a)){alert("手机号码不正确!");return false}return true}function doSendMobile(){if(!check_mobile()){jQuery("#verifyMobile").focus();return false}jQuery.post("/SMSVali/SMSSendValidateCode.do",{cellphone:document.getElementById("verifyMobile").value},sendMobileReturn);
return true}function sendMobileReturn(a){ret=a;if(ret=="success"){alert("验证码已成功发送到您的手机，请注意查收!")}else{if(ret=="validateCode is error"){alert("校验码输入错误!")}else{if(ret=="cellphone number is null"){alert("请输入手机号码!")}else{if(ret=="9"){alert("您不能验证!")}else{if(ret=="already valid"){alert("您已通过验证，无需再验证！")}else{if(ret=="phonenum is exists"){alert("该手机号已经和其他账户绑定，无法再次和您的账号绑定。")}else{if(ret=="too fast"){alert("请稍后!每次发送间隔不能小于一分钟")}else{if(ret=="overflow times"){alert("您今天已验证5次，无法再验证。!")}else{return}}}}}}}}}function doValidMobile(){if(!check_mobile()){document.getElementById("verifyMobile").focus();return false}jQuery.post("/SMSVali/mobileValidate.do",{cellphone:document.getElementById("verifyMobile").value,smsValidateCode:document.getElementById("verifyMobileCode").value},validMobileReturn);return true}function validMobileReturn(a){ret=a;
if(ret=="success validate"){alert("验证成功!恭喜您!");addCoupons()}else{if(ret=="incorrect code"){alert("验证码错误!")}else{if(ret=="validateCode is null"){alert("验证码不能为空")}else{if(ret=="incorrect userId"){alert("验证码无效")}else{if(ret=="validate code is expired"){alert("验证码已经过期")}else{if(ret=="cellphone number is null"){alert("请输入手机号码!")}else{if(ret=="user is null"){alert("您不能验证!")}else{if(ret=="already valid"){alert("您已通过验证！")}else{if(ret=="phonenum is exists"){alert("该手机号码已被别人验证过,您不能使用!")}else{if(ret=="overflow times"){alert("您今天已验证5次，无法再验证!")}else{if(ret=="wrong times"){alert("验证码已失效，请重新获取验证码!")}}}}}}}}}}}};/*
 * jQuery blockUI plugin
 * Version 2.33 (29-MAR-2010)
 * @requires jQuery v1.2.3 or later
 *
 * Examples at: http://malsup.com/jquery/block/
 * Copyright (c) 2007-2008 M. Alsup
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * Thanks to Amir-Hossein Sobhi for some excellent contributions!
 */
(function(i){if(/1\.(0|1|2)\.(0|1|2)/.test(i.fn.jquery)||/^1.1/.test(i.fn.jquery)){alert("blockUI requires jQuery v1.2.3 or later!  You are using v"+i.fn.jquery);return}i.fn._fadeIn=i.fn.fadeIn;var c=function(){};var j=document.documentMode||0;var e=i.browser.msie&&((i.browser.version<8&&!j)||j<8);var f=i.browser.msie&&/MSIE 6.0/.test(navigator.userAgent)&&!j;i.blockUI=function(p){d(window,p)};i.unblockUI=function(p){h(window,p)
};i.growlUI=function(t,r,s,p){var q=i('<div class="growlUI"></div>');if(t){q.append("<h1>"+t+"</h1>")}if(r){q.append("<h2>"+r+"</h2>")}if(s==undefined){s=3000}i.blockUI({message:q,fadeIn:700,fadeOut:1000,centerY:false,timeout:s,showOverlay:false,onUnblock:p,css:i.blockUI.defaults.growlCSS})};i.fn.block=function(p){return this.unblock({fadeOut:0}).each(function(){if(i.css(this,"position")=="static"){this.style.position="relative"}if(i.browser.msie){this.style.zoom=1}d(this,p)})};i.fn.unblock=function(p){return this.each(function(){h(this,p)})};i.blockUI.version=2.33;i.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:true,theme:false,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:0.6,cursor:"wait"},growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:0.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:false,baseZ:1000,centerX:true,centerY:true,allowBodyStretch:true,bindEvents:true,constrainTabKey:true,fadeIn:200,fadeOut:400,timeout:0,showOverlay:true,focusInput:true,applyPlatformOpacityRules:true,onBlock:null,onUnblock:null,quirksmodeOffsetHack:4};
var b=null;var g=[];function d(r,F){var A=(r==window);var w=F&&F.message!==undefined?F.message:undefined;F=i.extend({},i.blockUI.defaults,F||{});F.overlayCSS=i.extend({},i.blockUI.defaults.overlayCSS,F.overlayCSS||{});var C=i.extend({},i.blockUI.defaults.css,F.css||{});var N=i.extend({},i.blockUI.defaults.themedCSS,F.themedCSS||{});w=w===undefined?F.message:w;if(A&&b){h(window,{fadeOut:0})}if(w&&typeof w!="string"&&(w.parentNode||w.jquery)){var I=w.jquery?w[0]:w;var P={};i(r).data("blockUI.history",P);P.el=I;P.parent=I.parentNode;P.display=I.style.display;P.position=I.style.position;if(P.parent){P.parent.removeChild(I)}}var B=F.baseZ;var M=(i.browser.msie||F.forceIframe)?i('<iframe class="blockUI" style="z-index:'+(B++)+';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+F.iframeSrc+'"></iframe>'):i('<div class="blockUI" style="display:none"></div>');
var L=i('<div class="blockUI blockOverlay" style="z-index:'+(B++)+';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');var K,G;if(F.theme&&A){G='<div class="blockUI blockMsg blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+B+';display:none;position:fixed"><div class="ui-widget-header ui-dialog-titlebar blockTitle">'+(F.title||"&nbsp;")+'</div><div class="ui-widget-content ui-dialog-content"></div></div>'}else{if(F.theme){G='<div class="blockUI blockMsg blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+B+';display:none;position:absolute"><div class="ui-widget-header ui-dialog-titlebar blockTitle">'+(F.title||"&nbsp;")+'</div><div class="ui-widget-content ui-dialog-content"></div></div>'}else{if(A){G='<div class="blockUI blockMsg blockPage" style="z-index:'+B+';display:none;position:fixed"></div>'
}else{G='<div class="blockUI blockMsg blockElement" style="z-index:'+B+';display:none;position:absolute"></div>'}}}K=i(G);if(w){if(F.theme){K.css(N);K.addClass("ui-widget-content")}else{K.css(C)}}if(!F.applyPlatformOpacityRules||!(i.browser.mozilla&&/Linux/.test(navigator.platform))){L.css(F.overlayCSS)}L.css("position",A?"fixed":"absolute");if(i.browser.msie||F.forceIframe){M.css("opacity",0)}var y=[M,L,K],O=A?i("body"):i(r);i.each(y,function(){this.appendTo(O)});if(F.theme&&F.draggable&&i.fn.draggable){K.draggable({handle:".ui-dialog-titlebar",cancel:"li"})}var v=e&&(!i.boxModel||i("object,embed",A?null:r).length>0);if(f||v){if(A&&F.allowBodyStretch&&i.boxModel){i("html,body").css("height","100%")}if((f||!i.boxModel)&&!A){var E=m(r,"borderTopWidth"),J=m(r,"borderLeftWidth");var x=E?"(0 - "+E+")":0;
var D=J?"(0 - "+J+")":0}i.each([M,L,K],function(t,S){var z=S[0].style;z.position="absolute";if(t<2){A?z.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.boxModel?0:"+F.quirksmodeOffsetHack+') + "px"'):z.setExpression("height",'this.parentNode.offsetHeight + "px"');A?z.setExpression("width",'jQuery.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):z.setExpression("width",'this.parentNode.offsetWidth + "px"');if(D){z.setExpression("left",D)}if(x){z.setExpression("top",x)}}else{if(F.centerY){if(A){z.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"')
}z.marginTop=0}else{if(!F.centerY&&A){var Q=(F.css&&F.css.top)?parseInt(F.css.top):0;var R="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+Q+') + "px"';z.setExpression("top",R)}}}})}if(w){if(F.theme){K.find(".ui-widget-content").append(w)}else{K.append(w)}if(w.jquery||w.nodeType){i(w).show()}}if((i.browser.msie||F.forceIframe)&&F.showOverlay){M.show()}if(F.fadeIn){var H=F.onBlock?F.onBlock:c;var q=(F.showOverlay&&!w)?H:c;var p=w?H:c;if(F.showOverlay){L._fadeIn(F.fadeIn,q)}if(w){K._fadeIn(F.fadeIn,p)}}else{if(F.showOverlay){L.show()}if(w){K.show()}if(F.onBlock){F.onBlock()}}l(1,r,F);if(A){b=K[0];g=i(":input:enabled:visible",b);if(F.focusInput){setTimeout(o,20)}}else{a(K[0],F.centerX,F.centerY)}if(F.timeout){var u=setTimeout(function(){A?i.unblockUI(F):i(r).unblock(F)
},F.timeout);i(r).data("blockUI.timeout",u)}}function h(s,t){var r=(s==window);var q=i(s);var u=q.data("blockUI.history");var v=q.data("blockUI.timeout");if(v){clearTimeout(v);q.removeData("blockUI.timeout")}t=i.extend({},i.blockUI.defaults,t||{});l(0,s,t);var p;if(r){p=i("body").children().filter(".blockUI").add("body > .blockUI")}else{p=i(".blockUI",s)}if(r){b=g=null}if(t.fadeOut){p.fadeOut(t.fadeOut);setTimeout(function(){k(p,u,t,s)},t.fadeOut)}else{k(p,u,t,s)}}function k(p,s,r,q){p.each(function(t,u){if(this.parentNode){this.parentNode.removeChild(this)}});if(s&&s.el){s.el.style.display=s.display;s.el.style.position=s.position;if(s.parent){s.parent.appendChild(s.el)}i(q).removeData("blockUI.history")}if(typeof r.onUnblock=="function"){r.onUnblock(q,r)}}function l(p,t,u){var s=t==window,r=i(t);
if(!p&&(s&&!b||!s&&!r.data("blockUI.isBlocked"))){return}if(!s){r.data("blockUI.isBlocked",p)}if(!u.bindEvents||(p&&!u.showOverlay)){return}var q="mousedown mouseup keydown keypress";p?i(document).bind(q,u,n):i(document).unbind(q,n)}function n(s){if(s.keyCode&&s.keyCode==9){if(b&&s.data.constrainTabKey){var r=g;var q=!s.shiftKey&&s.target==r[r.length-1];var p=s.shiftKey&&s.target==r[0];if(q||p){setTimeout(function(){o(p)},10);return false}}}if(i(s.target).parents("div.blockMsg").length>0){return true}return i(s.target).parents().children().filter("div.blockUI").length==0}function o(p){if(!g){return}var q=g[p===true?g.length-1:0];if(q){q.focus()}}function a(w,q,A){var z=w.parentNode,v=w.style;var r=((z.offsetWidth-w.offsetWidth)/2)-m(z,"borderLeftWidth");var u=((z.offsetHeight-w.offsetHeight)/2)-m(z,"borderTopWidth");
if(q){v.left=r>0?(r+"px"):"0"}if(A){v.top=u>0?(u+"px"):"0"}}function m(q,r){return parseInt(i.css(q,r))||0}})(jQuery);Date.dayNames=["日","一","二","三","四","五","六"];Date.abbrDayNames=["日","一","二","三","四","五","六"];Date.monthNames=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"];Date.abbrMonthNames=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"];Date.firstDayOfWeek=0;Date.format="yyyy-mm-dd";Date.fullYearStart="20";(function(){function b(c,d){if(!Date.prototype[c]){Date.prototype[c]=d}}b("isLeapYear",function(){var c=this.getFullYear();return(c%4==0&&c%100!=0)||c%400==0});b("isWeekend",function(){return this.getDay()==0||this.getDay()==6});b("isWeekDay",function(){return !this.isWeekend()});b("getDaysInMonth",function(){return[31,(this.isLeapYear()?29:28),31,30,31,30,31,31,30,31,30,31][this.getMonth()]});b("getDayName",function(c){return c?Date.abbrDayNames[this.getDay()]:Date.dayNames[this.getDay()]
});b("getMonthName",function(c){return c?Date.abbrMonthNames[this.getMonth()]:Date.monthNames[this.getMonth()]});b("getDayOfYear",function(){var c=new Date("1/1/"+this.getFullYear());return Math.floor((this.getTime()-c.getTime())/86400000)});b("getWeekOfYear",function(){return Math.ceil(this.getDayOfYear()/7)});b("setDayOfYear",function(c){this.setMonth(0);this.setDate(c);return this});b("addYears",function(c){this.setFullYear(this.getFullYear()+c);return this});b("addMonths",function(d){var c=this.getDate();this.setMonth(this.getMonth()+d);if(c>this.getDate()){this.addDays(-this.getDate())}return this});b("addDays",function(c){this.setTime(this.getTime()+(c*86400000));return this});b("addHours",function(c){this.setHours(this.getHours()+c);return this});b("addMinutes",function(c){this.setMinutes(this.getMinutes()+c);
return this});b("addSeconds",function(c){this.setSeconds(this.getSeconds()+c);return this});b("zeroTime",function(){this.setMilliseconds(0);this.setSeconds(0);this.setMinutes(0);this.setHours(0);return this});b("asString",function(d){var c=d||Date.format;if(c.split("mm").length>1){c=c.split("mmmm").join(this.getMonthName(false)).split("mmm").join(this.getMonthName(true)).split("mm").join(a(this.getMonth()+1))}else{c=c.split("m").join(this.getMonth()+1)}c=c.split("yyyy").join(this.getFullYear()).split("yy").join((this.getFullYear()+"").substring(2)).split("dd").join(a(this.getDate())).split("d").join(this.getDate());return c});Date.fromString=function(h){var e=Date.format;var l=new Date("01/01/1970");if(h==""){return l}h=h.toLowerCase();var d="";var n=[];var k=/(dd?d?|mm?m?|yy?yy?)+([^(m|d|y)])?/g;
var q;while((q=k.exec(e))!=null){switch(q[1]){case"d":case"dd":case"m":case"mm":case"yy":case"yyyy":d+="(\\d+\\d?\\d?\\d?)+";n.push(q[1].substr(0,1));break;case"mmm":d+="([a-z]{3})";n.push("M");break}if(q[2]){d+=q[2]}}var c=new RegExp(d);var m=h.match(c);if(m!=null){for(var p=0;p<n.length;p++){var g=m[p+1];switch(n[p]){case"d":l.setDate(g);break;case"m":l.setMonth(Number(g)-1);break;case"M":for(var o=0;o<Date.abbrMonthNames.length;o++){if(Date.abbrMonthNames[o].toLowerCase()==g){break}}l.setMonth(o);break;case"y":l.setYear(g);break}}}return l};var a=function(c){var d="0"+c;return d.substring(d.length-2)}})();(function(b){b.fn.extend({renderCalendar:function(x){var p=function(i){return document.createElement(i)};x=b.extend({},b.fn.datePicker.defaults,x);if(x.showHeader!=b.dpConst.SHOW_HEADER_NONE){var o=b(p("tr"));
for(var A=Date.firstDayOfWeek;A<Date.firstDayOfWeek+7;A++){var h=A%7;var z=Date.dayNames[h];o.append(jQuery(p("th")).attr({scope:"col",abbr:z,title:z,"class":(h==0||h==6?"weekend":"weekday")}).html(x.showHeader==b.dpConst.SHOW_HEADER_SHORT?z.substr(0,1):z))}}var e=b(p("table")).attr({cellspacing:0,cellpadding:0}).addClass("jCalendar").append((x.showHeader!=b.dpConst.SHOW_HEADER_NONE?b(p("thead")).append(o):p("thead")));var f=b(p("tbody"));var C=(new Date()).zeroTime();var v=x.month==undefined?C.getMonth():x.month;var q=x.year||C.getFullYear();var m=new Date(q,v,1);var l=Date.firstDayOfWeek-m.getDay()+1;if(l>1){l-=7}var u=Math.ceil(((-1*l+1)+m.getDaysInMonth())/7);m.addDays(l-1);var t=function(i){return function(){if(x.hoverClass){var r=b(this);if(!x.selectWeek){r.addClass(x.hoverClass)}else{if(i&&!r.is(".disabled")){r.parent().addClass("activeWeekHover")
}}}}};var g=function(){if(x.hoverClass){var i=b(this);i.removeClass(x.hoverClass);i.parent().removeClass("activeWeekHover")}};var n=0;while(n++<u){var y=jQuery(p("tr"));var k=x.dpController?m>x.dpController.startDate:false;for(var A=0;A<7;A++){var j=m.getMonth()==v;var B=b(p("td")).text(m.getDate()+"").addClass((j?"current-month ":"other-month ")+(m.isWeekend()?"weekend ":"weekday ")+(j&&m.getTime()==C.getTime()?"today1 ":"")).data("datePickerDate",m.asString()).hover(t(k),g);y.append(B);if(x.renderCallback){x.renderCallback(B,m,v,q)}m=new Date(m.getFullYear(),m.getMonth(),m.getDate()+1)}f.append(y)}e.append(f);return this.each(function(){b(this).empty().append(e)})},datePicker:function(e){if(!b.event._dpCache){b.event._dpCache=[]}e=b.extend({},b.fn.datePicker.defaults,e);return this.each(function(){var h=b(this);
var f=true;if(!this._dpId){this._dpId=b.event.guid++;b.event._dpCache[this._dpId]=new c(this);f=false}if(e.inline){e.createButton=false;e.displayClose=false;e.closeOnSelect=false;h.empty()}var g=b.event._dpCache[this._dpId];g.init(e);if(!f&&e.createButton){g.button=b('<a href="#" class="dp-choose-date" title="'+b.dpText.TEXT_CHOOSE_DATE+'">'+b.dpText.TEXT_CHOOSE_DATE+"</a>").bind("click",function(){h.dpDisplay(this);this.blur();return false});h.after(g.button)}if(!f&&h.is(":text")){h.bind("dateSelected",function(j,l,k){this.value=l.asString();g._onSelectDate(l.asString(),this)}).bind("change",function(){if(this.value==""){g.clearSelected()}else{var j=Date.fromString(this.value);if(j){g.setSelected(j,true,true)}}});if(e.clickInput){h.bind("click",function(){h.trigger("change");h.dpDisplay()})
}var i=Date.fromString(this.value);if(this.value!=""&&i){g.setSelected(i,true,true)}}h.addClass("dp-applied")})},dpSetDisabled:function(e){return d.call(this,"setDisabled",e)},dpSetDisabledDate:function(e){return d.call(this,"setDisabledDate",e)},dpSetStartDate:function(e){return d.call(this,"setStartDate",e)},dpSetEndDate:function(e){return d.call(this,"setEndDate",e)},dpGetSelected:function(){var e=a(this[0]);if(e){return e.getSelected()}return null},dpSetSelected:function(f,h,g,e){if(h==undefined){h=true}if(g==undefined){g=true}if(e==undefined){e=true}return d.call(this,"setSelected",Date.fromString(f),h,g,e)},dpSetDisplayedMonth:function(e,f){return d.call(this,"setDisplayedMonth",Number(e),Number(f),true)},dpDisplay:function(e){return d.call(this,"display",e)},dpSetRenderCallback:function(e){return d.call(this,"setRenderCallback",e)
},dpSetPosition:function(e,f){return d.call(this,"setPosition",e,f)},dpSetOffset:function(e,f){return d.call(this,"setOffset",e,f)},dpClose:function(){return d.call(this,"_closeCalendar",false,this[0])},_dpDestroy:function(){}});var d=function(i,h,g,f,e){return this.each(function(){var j=a(this);if(j){j[i](h,g,f,e)}})};function c(e){this.ele=e;this.afterSelectDate={};this.displayedMonth=null;this.displayedYear=null;this.startDate=null;this.endDate=null;this.disabledDate=null;this.showYearNavigation=null;this.closeOnSelect=null;this.displayClose=null;this.rememberViewedMonth=null;this.selectMultiple=null;this.numSelectable=null;this.numSelected=null;this.verticalPosition=null;this.horizontalPosition=null;this.verticalOffset=null;this.horizontalOffset=null;this.button=null;this.renderCallback=[];
this.selectedDates={};this.inline=null;this.context="#dp-popup";this.settings={}}b.extend(c.prototype,{init:function(e){this.setAfterSelectDate(e.onSelectDate);this.setDisabledDate(e.disabledDate);this.setStartDate(e.startDate);this.setEndDate(e.endDate);this.setDisplayedMonth(Number(e.month),Number(e.year));this.setRenderCallback(e.renderCallback);this.showYearNavigation=e.showYearNavigation;this.closeOnSelect=e.closeOnSelect;this.displayClose=e.displayClose;this.rememberViewedMonth=e.rememberViewedMonth;this.selectMultiple=e.selectMultiple;this.numSelectable=e.selectMultiple?e.numSelectable:1;this.numSelected=0;this.verticalPosition=e.verticalPosition;this.horizontalPosition=e.horizontalPosition;this.hoverClass=e.hoverClass;this.setOffset(e.verticalOffset,e.horizontalOffset);this.inline=e.inline;
this.settings=e;if(this.inline){this.context=this.ele;this.display()}},setDisabledDate:function(e){if(e){this.disabledDate=e}},setStartDate:function(e){if(e){this.startDate=Date.fromString(e)}if(!this.startDate){this.startDate=(new Date()).zeroTime()}this.setDisplayedMonth(this.displayedMonth,this.displayedYear)},setEndDate:function(e){if(e){this.endDate=Date.fromString(e)}if(!this.endDate){this.endDate=(new Date("12/31/2999"))}if(this.endDate.getTime()<this.startDate.getTime()){this.endDate=this.startDate}this.setDisplayedMonth(this.displayedMonth,this.displayedYear)},setPosition:function(e,f){this.verticalPosition=e;this.horizontalPosition=f},setOffset:function(e,f){this.verticalOffset=parseInt(e)||0;this.horizontalOffset=parseInt(f)||0},setDisabled:function(e){$e=b(this.ele);$e[e?"addClass":"removeClass"]("dp-disabled");
if(this.button){$but=b(this.button);$but[e?"addClass":"removeClass"]("dp-disabled");$but.attr("title",e?"":b.dpText.TEXT_CHOOSE_DATE)}if($e.is(":text")){$e.attr("disabled",e?"disabled":"")}},setDisplayedMonth:function(i,h,l){if(this.startDate==undefined||this.endDate==undefined){return}var k=new Date(this.startDate.getTime());k.setDate(1);var g=new Date(this.endDate.getTime());g.setDate(1);var f;if((!i&&!h)||(isNaN(i)&&isNaN(h))){f=new Date().zeroTime();f.setDate(1)}else{if(isNaN(i)){f=new Date(h,this.displayedMonth,1)}else{if(isNaN(h)){f=new Date(this.displayedYear,i,1)}else{f=new Date(h,i,1)}}}if(f.getTime()<k.getTime()){f=k}else{if(f.getTime()>g.getTime()){f=g}}var j=this.displayedMonth;var e=this.displayedYear;this.displayedMonth=f.getMonth();this.displayedYear=f.getFullYear();if(l&&(this.displayedMonth!=j||this.displayedYear!=e)){this._rerenderCalendar();
b(this.ele).trigger("dpMonthChanged",[this.displayedMonth,this.displayedYear])}},setSelected:function(g,h,j,f){if(g<this.startDate||g>this.endDate){return}var l=this.settings;if(l.selectWeek){g=g.addDays(-(g.getDay()-Date.firstDayOfWeek+7)%7);if(g<this.startDate){return}}if(h==this.isSelected(g)){return}if(this.selectMultiple==false){this.clearSelected()}else{if(h&&this.numSelected==this.numSelectable){return}}if(j&&(this.displayedMonth!=g.getMonth()||this.displayedYear!=g.getFullYear())){this.setDisplayedMonth(g.getMonth(),g.getFullYear(),true)}this.selectedDates[g.toString()]=h;this.numSelected+=h?1:-1;var k="td."+(g.getMonth()==this.displayedMonth?"current-month":"other-month");var e;b(k,this.context).each(function(){if(b(this).data("datePickerDate")==g.asString()){e=b(this);if(l.selectWeek){e.parent()[h?"addClass":"removeClass"]("selectedWeek")
}e[h?"addClass":"removeClass"]("selected")}});b("td",this.context).not(".selected")[this.selectMultiple&&this.numSelected==this.numSelectable?"addClass":"removeClass"]("unselectable");if(f){var l=this.isSelected(g);$e=b(this.ele);var i=Date.fromString(g.asString());$e.trigger("dateSelected",[i,e,l]);$e.trigger("change")}},isSelected:function(e){return this.selectedDates[e.toString()]},getSelected:function(){var e=[];for(s in this.selectedDates){if(this.selectedDates[s]==true){e.push(Date.parse(s))}}return e},clearSelected:function(){this.selectedDates={};this.numSelected=0;b("td.selected",this.context).removeClass("selected").parent().removeClass("selectedWeek")},display:function(l){if(b(this.ele).is(".dp-disabled")){return}l=l||this.ele;var i=this;var e=b(l);var h=e.offset();var j;var k;var n;
var f;if(i.inline){j=b(this.ele);k={id:"calendar-"+this.ele._dpId,"class":"dp-popup dp-popup-inline"};b(".dp-popup",j).remove();f={}}else{j=b("body");k={id:"dp-popup","class":"dp-popup"};f={top:h.top+i.verticalOffset+20,left:h.left+i.horizontalOffset};var g=function(r){var p=r.target;var q=b("#dp-popup")[0];while(true){if(p==q){return true}else{if(p==document){i._closeCalendar();return false}else{p=b(p).parent()[0]}}}};this._checkMouse=g;i._closeCalendar(true);b(document).bind("keydown.datepicker",function(p){if(p.keyCode==27){i._closeCalendar()}})}if(!i.rememberViewedMonth){var o=this.getSelected()[0];if(o){o=new Date(o);this.setDisplayedMonth(o.getMonth(),o.getFullYear(),false)}}j.append(b("<div></div>").attr(k).css(f).append(b("<h2></h2>"),b('<div class="dp-nav-prev"></div>').append(b('<a class="dp-nav-prev-year" href="#" title="'+b.dpText.TEXT_PREV_YEAR+'">&laquo;</a>').bind("click",function(){return i._displayNewMonth.call(i,this,0,-1)
}),b('<a class="dp-nav-prev-month" href="#" title="'+b.dpText.TEXT_PREV_MONTH+'">&lt;</a>').bind("click",function(){return i._displayNewMonth.call(i,this,-1,0)})),b('<div class="dp-nav-next"></div>').append(b('<a class="dp-nav-next-year" href="#" title="'+b.dpText.TEXT_NEXT_YEAR+'">&raquo;</a>').bind("click",function(){return i._displayNewMonth.call(i,this,0,1)}),b('<a class="dp-nav-next-month" href="#" title="'+b.dpText.TEXT_NEXT_MONTH+'">&gt;</a>').bind("click",function(){return i._displayNewMonth.call(i,this,1,0)})),b('<div class="dp-calendar"></div>')).bgIframe());var m=this.inline?b(".dp-popup",this.context):b("#dp-popup");if(this.showYearNavigation==false){b(".dp-nav-prev-year, .dp-nav-next-year",i.context).css("display","none")}if(this.displayClose){m.append(b('<a href="#" id="dp-close">'+b.dpText.TEXT_CLOSE+"</a>").bind("click",function(){i._closeCalendar();
return false}))}i._renderCalendar();b(this.ele).trigger("dpDisplayed",m);if(!i.inline){if(this.verticalPosition==b.dpConst.POS_BOTTOM){m.css("top",h.top+e.height()-m.height()+i.verticalOffset)}if(this.horizontalPosition==b.dpConst.POS_RIGHT){m.css("left",h.left+e.width()-m.width()+i.horizontalOffset)}b(document).bind("mousedown.datepicker",this._checkMouse)}},setRenderCallback:function(e){if(e==null){return}if(e&&typeof(e)=="function"){e=[e]}this.renderCallback=this.renderCallback.concat(e)},setAfterSelectDate:function(e){this.afterSelectDate=e},cellRender:function(e,g,i,h){var f=this.dpController;var j=new Date(g.getTime());e.bind("click",function(){var k=b(this);if(!k.is(".disabled")){f.setSelected(j,!k.is(".selected")||!f.selectMultiple,false,true);if(f.closeOnSelect){f._closeCalendar()}if(!b.browser.msie){b(f.ele).trigger("focus",[b.dpConst.DP_INTERNAL_FOCUS])
}}});if(f.isSelected(j)){e.addClass("selected");if(f.settings.selectWeek){e.parent().addClass("selectedWeek")}}else{if(f.selectMultiple&&f.numSelected==f.numSelectable){e.addClass("unselectable")}}},_applyRenderCallbacks:function(){var e=this;b("td",this.context).each(function(){for(var f=0;f<e.renderCallback.length;f++){$td=b(this);e.renderCallback[f].apply(this,[$td,Date.fromString($td.data("datePickerDate")),e.displayedMonth,e.displayedYear])}});return},_displayNewMonth:function(e,g,f){if(!b(e).is(".disabled")){this.setDisplayedMonth(this.displayedMonth+g,this.displayedYear+f,true)}e.blur();return false},_rerenderCalendar:function(){this._clearCalendar();this._renderCalendar()},_renderCalendar:function(){b("h2",this.context).html((new Date(this.displayedYear,this.displayedMonth,1)).asString(b.dpText.HEADER_FORMAT));
b(".dp-calendar",this.context).renderCalendar(b.extend({},this.settings,{month:this.displayedMonth,year:this.displayedYear,renderCallback:this.cellRender,dpController:this,hoverClass:this.hoverClass}));var h=this.disabledDate;var f=function(r,j){var p=false;if(r!=null&&j!=null){var q=r.split(",");if(q.length>0){for(var i=0;i<q.length;i++){if(parseInt(j)==parseInt(q[i])){p=true;break}}}}return p};if(this.displayedYear==this.startDate.getFullYear()&&this.displayedMonth==this.startDate.getMonth()){b(".dp-nav-prev-year",this.context).addClass("disabled");b(".dp-nav-prev-month",this.context).addClass("disabled");b(".dp-calendar td.other-month",this.context).each(function(){var i=b(this);if(Number(i.text())>20){i.addClass("disabled")}});var e=this.startDate.getDate();b(".dp-calendar td.current-month",this.context).each(function(){var i=b(this);
if(Number(i.text())<e){i.addClass("disabled")}})}else{b(".dp-nav-prev-year",this.context).removeClass("disabled");b(".dp-nav-prev-month",this.context).removeClass("disabled");var e=this.startDate.getDate();if(e>20){var k=this.startDate.getTime();var l=new Date(k);l.addMonths(1);if(this.displayedYear==l.getFullYear()&&this.displayedMonth==l.getMonth()){b(".dp-calendar td.other-month",this.context).each(function(){var i=b(this);if(Date.fromString(i.data("datePickerDate")).getTime()<k){i.addClass("disabled")}})}}}if(this.displayedYear==this.endDate.getFullYear()&&this.displayedMonth==this.endDate.getMonth()){b(".dp-nav-next-year",this.context).addClass("disabled");b(".dp-nav-next-month",this.context).addClass("disabled");b(".dp-calendar td.other-month",this.context).each(function(){var i=b(this);
if(Number(i.text())<14){i.addClass("disabled")}});var e=this.endDate.getDate();b(".dp-calendar td.current-month",this.context).each(function(){var i=b(this);if(Number(i.text())>e){i.addClass("disabled")}})}else{b(".dp-nav-next-year",this.context).removeClass("disabled");b(".dp-nav-next-month",this.context).removeClass("disabled");var e=this.endDate.getDate();if(e<13){var g=new Date(this.endDate.getTime());g.addMonths(-1);if(this.displayedYear==g.getFullYear()&&this.displayedMonth==g.getMonth()){b(".dp-calendar td.other-month",this.context).each(function(){var i=b(this);if(Number(i.text())>e){i.addClass("disabled")}})}}}b(".dp-calendar td.current-month,.dp-calendar td.other-month",this.context).each(function(){var i=b(this);if(f(h,i.text())){i.addClass("disabled")}});this._applyRenderCallbacks()
},_closeCalendar:function(e,f){if(!f||f==this.ele){b(document).unbind("mousedown.datepicker");b(document).unbind("keydown.datepicker");this._clearCalendar();b("#dp-popup a").unbind();b("#dp-popup").empty().remove();if(!e){b(this.ele).trigger("dpClosed",[this.getSelected()])}}},_onSelectDate:function(f,e){this.afterSelectDate(f,e)},_clearCalendar:function(){b(".dp-calendar td",this.context).unbind();b(".dp-calendar",this.context).empty()}});b.dpConst={SHOW_HEADER_NONE:0,SHOW_HEADER_SHORT:1,SHOW_HEADER_LONG:2,POS_TOP:0,POS_BOTTOM:1,POS_LEFT:0,POS_RIGHT:1,DP_INTERNAL_FOCUS:"dpInternalFocusTrigger"};b.dpText={TEXT_PREV_YEAR:"上一年",TEXT_PREV_MONTH:"上个月",TEXT_NEXT_YEAR:"下一年",TEXT_NEXT_MONTH:"下个月",TEXT_CLOSE:"关闭",TEXT_CHOOSE_DATE:"选择日期",HEADER_FORMAT:"mmmm yyyy"};b.dpVersion="$Id: jquery.datePicker.js 70 2009-04-05 19:25:15Z kelvin.luck $";
b.fn.datePicker.defaults={month:undefined,year:undefined,showHeader:b.dpConst.SHOW_HEADER_SHORT,startDate:undefined,endDate:undefined,inline:false,renderCallback:null,createButton:false,showYearNavigation:true,closeOnSelect:true,displayClose:false,selectMultiple:false,numSelectable:Number.MAX_VALUE,clickInput:true,rememberViewedMonth:true,selectWeek:false,verticalPosition:b.dpConst.POS_TOP,horizontalPosition:b.dpConst.POS_LEFT,verticalOffset:0,horizontalOffset:0,hoverClass:"dp-hover"};function a(e){if(e._dpId){return b.event._dpCache[e._dpId]}return false}if(b.fn.bgIframe==undefined){b.fn.bgIframe=function(){return this}}b(window).bind("unload",function(){var f=b.event._dpCache||[];for(var e in f){b(f[e].ele)._dpDestroy()}})})(jQuery);Date.prototype.Format=function(e){var g=e;var f=["日","一","二","三","四","五","六"];
var h=this.getMonth()+1;g=g.replace(/yyyy|YYYY/,this.getFullYear());g=g.replace(/yy|YY/,(this.getYear()%100)>9?(this.getYear()%100).toString():"0"+(this.getYear()%100));g=g.replace(/MM/,h>9?h.toString():"0"+h);g=g.replace(/M/g,h);g=g.replace(/w|W/g,f[this.getDay()]);g=g.replace(/dd|DD/,this.getDate()>9?this.getDate().toString():"0"+this.getDate());g=g.replace(/d|D/g,this.getDate());g=g.replace(/hh|HH/,this.getHours()>9?this.getHours().toString():"0"+this.getHours());g=g.replace(/h|H/g,this.getHours());g=g.replace(/mm/,this.getMinutes()>9?this.getMinutes().toString():"0"+this.getMinutes());g=g.replace(/m/g,this.getMinutes());g=g.replace(/ss|SS/,this.getSeconds()>9?this.getSeconds().toString():"0"+this.getSeconds());g=g.replace(/s|S/g,this.getSeconds());return g};Date.prototype.DateAdd=function(d,e){var f=this;
if(d!=null){switch(d){case"s":return new Date(Date.parse(f)+(1000*e));case"n":return new Date(Date.parse(f)+(60000*e));case"h":return new Date(Date.parse(f)+(3600000*e));case"d":return new Date(Date.parse(f)+(86400000*e));case"w":return new Date(Date.parse(f)+((86400000*7)*e));case"q":return new Date(f.getFullYear(),(f.getMonth())+e*3,f.getDate(),f.getHours(),f.getMinutes(),f.getSeconds());case"m":return new Date(f.getFullYear(),(f.getMonth())+e,f.getDate(),f.getHours(),f.getMinutes(),f.getSeconds());case"y":return new Date((f.getFullYear()+e),f.getMonth(),f.getDate(),f.getHours(),f.getMinutes(),f.getSeconds())}}};